import{y as E,R as V,T as j,J as q,j as i,a9 as H,_ as J,a as O,r as m,A as U,i as K,c as M,d as a,m as l,e as v,k as n,aj as $,t as c,N as Q,q as L,I as X,al as z,ak as Y,at as Z,au as ee,F as te,l as ae,$ as se,o as w}from"./index-Dj3ETPvc.js";import{T as P,E as oe}from"./index-le55krO_.js";const[ne,le]=q("divider"),ie={dashed:Boolean,hairline:j,vertical:Boolean,contentPosition:V("center")};var re=E({name:ne,props:ie,setup(f,{slots:_}){return()=>{var d;return i("div",{role:"separator",class:le({dashed:f.dashed,hairline:f.hairline,vertical:f.vertical,[`content-${f.contentPosition}`]:!!_.default&&!f.vertical})},[!f.vertical&&((d=_.default)==null?void 0:d.call(_))])}}});const D=H(re),ce={class:"map-container"},de={class:"divider-container"},ue={class:"button-group"},pe={class:"btn-text"},ve={key:0,class:"loading-container"},ge={key:1,class:"info-container"},me={class:"weather-box"},fe={class:"weather-title"},_e={class:"weather-detail"},we={class:"detail-item"},ye={class:"detail-value"},he={class:"detail-item"},be={class:"detail-value"},Ae={class:"detail-item"},ke={class:"detail-value"},Me={class:"detail-item"},Pe={class:"detail-value"},Ce={class:"update-time"},xe={class:"poi-title"},Le={class:"poi-name"},Be={class:"poi-address"},Ie={__name:"IPMap",setup(f){const _=O(),d=m(null),p=m(null),y=m(null),h=m(!1),r=U({lng:"",lat:""}),b=m(""),A=m(""),C=m([]),u=m(null),k=m(!1),T=(s=[116.397428,39.90923])=>{d.value=new AMap.Map("container",{zoom:13,center:s,viewMode:"2D"})},F=s=>{p.value&&d.value.remove(p.value),p.value=new AMap.Marker({position:new AMap.LngLat(s.lng,s.lat),title:"拖动我选择位置",draggable:!0,cursor:"move"}),p.value.on("dragend",e=>{const t=e.target.getPosition();r.lng=t.getLng(),r.lat=t.getLat(),d.value.setCenter([r.lng,r.lat]),x(r.lng,r.lat),I(r.lng,r.lat)}),p.value.on("click",()=>{y.value.open(d.value,p.value.getPosition())}),d.value.add(p.value)},B=()=>{h.value=!0,b.value="",A.value="",u.value=null,AMap.plugin("AMap.Geolocation",()=>{const s=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});s.on("complete",async e=>{const t=e.position.getLng(),o=e.position.getLat();r.lng=t,r.lat=o,await x(t,o),d.value.setCenter([t,o]),F({lng:t,lat:o}),I(t,o)}),s.on("error",e=>{h.value=!1,console.error("定位失败:",e),alert("定位失败，请检查浏览器权限或网络")}),s.getCurrentPosition()})},x=async(s,e)=>{h.value=!0,AMap.plugin("AMap.Geocoder",async()=>{new AMap.Geocoder({radius:1e3,extensions:"all"}).getAddress(new AMap.LngLat(s,e),async(o,g)=>{o==="complete"&&g.regeocode?W(g.regeocode):await R(s,e),h.value=!1})})},W=s=>{b.value=s.formattedAddress,A.value=s.addressComponent.adcode,N(b.value),G(A.value)},R=async(s,e)=>{try{const t=await _.fetchAddressByRestApi(s,e);t.status==="1"&&t.regeocode&&(b.value=t.regeocode.formatted_address,A.value=t.regeocode.addressComponent.adcode,N(b.value),G(A.value))}catch(t){console.error("地址解析失败:",t)}},I=async(s,e)=>{var t;try{const o=await _.searchNearbyPoisByApi(s,e);o.status==="1"&&((t=o.pois)==null?void 0:t.length)>0&&(C.value=o.pois.map(g=>({name:g.name,address:g.address,distance:parseInt(g.distance),location:{lng:parseFloat(g.location.split(",")[0]),lat:parseFloat(g.location.split(",")[1])}})))}catch(o){console.error("周边地点搜索失败:",o)}},G=async s=>{var e;try{const t=await _.fetchWeatherByAdcode(s);if(t.status==="1"&&((e=t.lives)==null?void 0:e.length)>0){const o=t.lives[0];u.value={city:o.city,province:o.province,weather:o.weather,temperature:`${o.temperature}℃`,humidity:`${o.humidity}%`,winddirection:o.winddirection,windpower:o.windpower,reporttime:o.reporttime}}}catch(t){console.error("天气获取失败:",t)}},N=s=>{y.value||(y.value=new AMap.InfoWindow),y.value.setContent(s),p.value&&y.value.open(d.value,p.value.getPosition())},S=s=>{const{lng:e,lat:t}=s.location;r.lng=e,r.lat=t,d.value.setCenter([e,t]),p.value.setPosition(new AMap.LngLat(e,t)),x(e,t)};return K(()=>{T(),B()}),(s,e)=>(w(),M("div",ce,[e[11]||(e[11]=a("div",{class:"bg-decoration"},[a("div",{class:"bg-circle bg-circle-1"}),a("div",{class:"bg-circle bg-circle-2"}),a("div",{class:"bg-circle bg-circle-3"})],-1)),a("div",de,[i(n(D),{style:{color:"#667eea",borderColor:"#667eea",padding:"0 16px"},class:"beautiful-divider"},{default:l(()=>e[3]||(e[3]=[v(" 🗺️ 地区选择 ")])),_:1,__:[3]})]),e[12]||(e[12]=a("div",{class:"map-wrapper"},[a("div",{id:"container",class:"map"})],-1)),a("div",ue,[i(n($),{type:"primary",round:"",onClick:B,icon:"location-o",class:"action-btn location-btn"},{default:l(()=>e[4]||(e[4]=[a("span",{class:"btn-text"},"📍 重新定位",-1)])),_:1,__:[4]}),i(n($),{type:"success",round:"",onClick:e[0]||(e[0]=t=>k.value=!0),icon:"location-o",class:"action-btn poi-btn"},{default:l(()=>[a("span",pe,"🏪 周边地点 ("+c(C.value.length)+")",1)]),_:1})]),h.value?(w(),M("div",ve,[i(n(Q),{vertical:"",class:"custom-loading"},{default:l(()=>e[5]||(e[5]=[a("div",{class:"loading-text"},"🌍 正在获取位置信息...",-1)])),_:1,__:[5]})])):(w(),M("div",ge,[i(n(Y),{class:"info-group"},{default:l(()=>[a("div",me,[i(n(D),{"content-position":"left",style:{color:"#07c160",margin:"16px 0"},class:"weather-divider"},{default:l(()=>[i(n(X),{name:"weather-o",size:"20",class:"weather-icon"}),e[6]||(e[6]=v(" 🌤️ 天气信息 "))]),_:1,__:[6]}),u.value?(w(),L(n(z),{key:0,class:"weather-cell"},{title:l(()=>[a("div",fe,[i(n(P),{type:"primary",size:"large",class:"location-tag"},{default:l(()=>[v(c(u.value.province),1)]),_:1}),i(n(P),{type:"success",size:"large",class:"location-tag"},{default:l(()=>[v(c(u.value.city),1)]),_:1}),i(n(P),{plain:"",type:"warning",size:"large",class:"weather-tag"},{default:l(()=>[v(c(u.value.weather),1)]),_:1})])]),label:l(()=>[a("div",_e,[a("p",we,[e[7]||(e[7]=v("🌡️ 温度: ")),a("span",ye,c(u.value.temperature),1)]),a("p",he,[e[8]||(e[8]=v("💧 湿度: ")),a("span",be,c(u.value.humidity),1)]),a("p",Ae,[e[9]||(e[9]=v("🎐 风向: ")),a("span",ke,c(u.value.winddirection),1)]),a("p",Me,[e[10]||(e[10]=v("🌀 风力: ")),a("span",Pe,c(u.value.windpower),1)]),a("p",Ce,"🕒 "+c(u.value.reporttime),1)])]),_:1})):(w(),L(n(oe),{key:1,description:"🌫️ 暂无天气信息",class:"empty-state"}))])]),_:1})])),i(n(se),{show:k.value,"onUpdate:show":e[2]||(e[2]=t=>k.value=t),position:"bottom",style:{height:"70%",borderRadius:"20px 20px 0 0"},class:"poi-popup"},{default:l(()=>[i(n(Z),{title:"🏪 周边地点","left-text":"关闭","left-arrow":"",onClickLeft:e[1]||(e[1]=t=>k.value=!1),class:"poi-nav-bar"}),i(n(ee),{class:"poi-drawer"},{default:l(()=>[(w(!0),M(te,null,ae(C.value,(t,o)=>(w(),L(n(z),{key:o,onClick:g=>S(t),class:"poi-cell"},{title:l(()=>[a("div",xe,[a("span",Le,"📍 "+c(t.name),1),i(n(P),{type:"danger",class:"distance-tag"},{default:l(()=>[v(c(t.distance)+"米 ",1)]),_:2},1024)])]),label:l(()=>[a("span",Be,"🏠 "+c(t.address),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["show"])]))}},$e=J(Ie,[["__scopeId","data-v-edc2f897"]]);export{$e as default};

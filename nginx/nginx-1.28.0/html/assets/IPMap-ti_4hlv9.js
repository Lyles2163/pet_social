import{_ as R,a as S,r as g,C as V,j,c as A,d as a,k as i,n,e as p,l,al as D,t as c,P as H,x as P,I as O,an as z,am as U,at as q,au as J,F as K,m as Q,a1 as X,o as _}from"./index-oKQHfQLO.js";import{D as N}from"./index-BZ_QH8Qk.js";import{T as M,E as Y}from"./index-D8Sl0YT2.js";const Z={class:"map-container"},ee={class:"divider-container"},te={class:"button-group"},ae={class:"btn-text"},se={key:0,class:"loading-container"},oe={key:1,class:"info-container"},le={class:"weather-box"},ne={class:"weather-title"},ie={class:"weather-detail"},re={class:"detail-item"},ce={class:"detail-value"},de={class:"detail-item"},ue={class:"detail-value"},pe={class:"detail-item"},ve={class:"detail-value"},ge={class:"detail-item"},me={class:"detail-value"},_e={class:"update-time"},fe={class:"poi-title"},we={class:"poi-name"},ye={class:"poi-address"},he={__name:"IPMap",setup(be){const k=S(),m=g(null),u=g(null),f=g(null),w=g(!1),r=V({lng:"",lat:""}),y=g(""),h=g(""),x=g([]),d=g(null),b=g(!1),F=(s=[116.397428,39.90923])=>{m.value=new AMap.Map("container",{zoom:13,center:s,viewMode:"2D"})},T=s=>{u.value&&m.value.remove(u.value),u.value=new AMap.Marker({position:new AMap.LngLat(s.lng,s.lat),title:"拖动我选择位置",draggable:!0,cursor:"move"}),u.value.on("dragend",e=>{const t=e.target.getPosition();r.lng=t.getLng(),r.lat=t.getLat(),m.value.setCenter([r.lng,r.lat]),C(r.lng,r.lat),B(r.lng,r.lat)}),u.value.on("click",()=>{f.value.open(m.value,u.value.getPosition())}),m.value.add(u.value)},L=()=>{w.value=!0,y.value="",h.value="",d.value=null,AMap.plugin("AMap.Geolocation",()=>{const s=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});s.on("complete",async e=>{const t=e.position.getLng(),o=e.position.getLat();r.lng=t,r.lat=o,await C(t,o),m.value.setCenter([t,o]),T({lng:t,lat:o}),B(t,o)}),s.on("error",e=>{w.value=!1,console.error("定位失败:",e),alert("定位失败，请检查浏览器权限或网络")}),s.getCurrentPosition()})},C=async(s,e)=>{w.value=!0,AMap.plugin("AMap.Geocoder",async()=>{new AMap.Geocoder({radius:1e3,extensions:"all"}).getAddress(new AMap.LngLat(s,e),async(o,v)=>{o==="complete"&&v.regeocode?W(v.regeocode):await $(s,e),w.value=!1})})},W=s=>{y.value=s.formattedAddress,h.value=s.addressComponent.adcode,I(y.value),G(h.value)},$=async(s,e)=>{try{const t=await k.fetchAddressByRestApi(s,e);t.status==="1"&&t.regeocode&&(y.value=t.regeocode.formatted_address,h.value=t.regeocode.addressComponent.adcode,I(y.value),G(h.value))}catch(t){console.error("地址解析失败:",t)}},B=async(s,e)=>{var t;try{const o=await k.searchNearbyPoisByApi(s,e);o.status==="1"&&((t=o.pois)==null?void 0:t.length)>0&&(x.value=o.pois.map(v=>({name:v.name,address:v.address,distance:parseInt(v.distance),location:{lng:parseFloat(v.location.split(",")[0]),lat:parseFloat(v.location.split(",")[1])}})))}catch(o){console.error("周边地点搜索失败:",o)}},G=async s=>{var e;try{const t=await k.fetchWeatherByAdcode(s);if(t.status==="1"&&((e=t.lives)==null?void 0:e.length)>0){const o=t.lives[0];d.value={city:o.city,province:o.province,weather:o.weather,temperature:`${o.temperature}℃`,humidity:`${o.humidity}%`,winddirection:o.winddirection,windpower:o.windpower,reporttime:o.reporttime}}}catch(t){console.error("天气获取失败:",t)}},I=s=>{f.value||(f.value=new AMap.InfoWindow),f.value.setContent(s),u.value&&f.value.open(m.value,u.value.getPosition())},E=s=>{const{lng:e,lat:t}=s.location;r.lng=e,r.lat=t,m.value.setCenter([e,t]),u.value.setPosition(new AMap.LngLat(e,t)),C(e,t)};return j(()=>{F(),L()}),(s,e)=>(_(),A("div",Z,[e[11]||(e[11]=a("div",{class:"bg-decoration"},[a("div",{class:"bg-circle bg-circle-1"}),a("div",{class:"bg-circle bg-circle-2"}),a("div",{class:"bg-circle bg-circle-3"})],-1)),a("div",ee,[i(l(N),{style:{color:"#667eea",borderColor:"#667eea",padding:"0 16px"},class:"beautiful-divider"},{default:n(()=>e[3]||(e[3]=[p(" 🗺️ 地区选择 ")])),_:1,__:[3]})]),e[12]||(e[12]=a("div",{class:"map-wrapper"},[a("div",{id:"container",class:"map"})],-1)),a("div",te,[i(l(D),{type:"primary",round:"",onClick:L,icon:"location-o",class:"action-btn location-btn"},{default:n(()=>e[4]||(e[4]=[a("span",{class:"btn-text"},"📍 重新定位",-1)])),_:1,__:[4]}),i(l(D),{type:"success",round:"",onClick:e[0]||(e[0]=t=>b.value=!0),icon:"location-o",class:"action-btn poi-btn"},{default:n(()=>[a("span",ae,"🏪 周边地点 ("+c(x.value.length)+")",1)]),_:1})]),w.value?(_(),A("div",se,[i(l(H),{vertical:"",class:"custom-loading"},{default:n(()=>e[5]||(e[5]=[a("div",{class:"loading-text"},"🌍 正在获取位置信息...",-1)])),_:1,__:[5]})])):(_(),A("div",oe,[i(l(U),{class:"info-group"},{default:n(()=>[a("div",le,[i(l(N),{"content-position":"left",style:{color:"#07c160",margin:"16px 0"},class:"weather-divider"},{default:n(()=>[i(l(O),{name:"weather-o",size:"20",class:"weather-icon"}),e[6]||(e[6]=p(" 🌤️ 天气信息 "))]),_:1,__:[6]}),d.value?(_(),P(l(z),{key:0,class:"weather-cell"},{title:n(()=>[a("div",ne,[i(l(M),{type:"primary",size:"large",class:"location-tag"},{default:n(()=>[p(c(d.value.province),1)]),_:1}),i(l(M),{type:"success",size:"large",class:"location-tag"},{default:n(()=>[p(c(d.value.city),1)]),_:1}),i(l(M),{plain:"",type:"warning",size:"large",class:"weather-tag"},{default:n(()=>[p(c(d.value.weather),1)]),_:1})])]),label:n(()=>[a("div",ie,[a("p",re,[e[7]||(e[7]=p("🌡️ 温度: ")),a("span",ce,c(d.value.temperature),1)]),a("p",de,[e[8]||(e[8]=p("💧 湿度: ")),a("span",ue,c(d.value.humidity),1)]),a("p",pe,[e[9]||(e[9]=p("🎐 风向: ")),a("span",ve,c(d.value.winddirection),1)]),a("p",ge,[e[10]||(e[10]=p("🌀 风力: ")),a("span",me,c(d.value.windpower),1)]),a("p",_e,"🕒 "+c(d.value.reporttime),1)])]),_:1})):(_(),P(l(Y),{key:1,description:"🌫️ 暂无天气信息",class:"empty-state"}))])]),_:1})])),i(l(X),{show:b.value,"onUpdate:show":e[2]||(e[2]=t=>b.value=t),position:"bottom",style:{height:"70%",borderRadius:"20px 20px 0 0"},class:"poi-popup"},{default:n(()=>[i(l(q),{title:"🏪 周边地点","left-text":"关闭","left-arrow":"",onClickLeft:e[1]||(e[1]=t=>b.value=!1),class:"poi-nav-bar"}),i(l(J),{class:"poi-drawer"},{default:n(()=>[(_(!0),A(K,null,Q(x.value,(t,o)=>(_(),P(l(z),{key:o,onClick:v=>E(t),class:"poi-cell"},{title:n(()=>[a("div",fe,[a("span",we,"📍 "+c(t.name),1),i(l(M),{type:"danger",class:"distance-tag"},{default:n(()=>[p(c(t.distance)+"米 ",1)]),_:2},1024)])]),label:n(()=>[a("span",ye,"🏠 "+c(t.address),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["show"])]))}},xe=R(he,[["__scopeId","data-v-edc2f897"]]);export{xe as default};

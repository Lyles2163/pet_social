import{A as K,a8 as M,L as z,k as g,$ as O,a0 as F,a1 as j,ay as U,Y as D,V as H,Q as L,ab as q,ax as G,r as y,a as Q,f as S,_ as Y,j as J,c as v,d as l,n as m,l as s,I as W,S as X,ak as b,x as f,F as P,m as T,az as x,aA as Z,h as ee,o as n,e as A,t as V,an as B}from"./index-oKQHfQLO.js";import{E as C,T as E}from"./index-D8Sl0YT2.js";import{I as te}from"./index-BjlJGxRV.js";const[ae,se]=z("notify"),re=["lockScroll","position","show","teleport","zIndex"],oe=M({},U,{type:H("danger"),color:String,message:L,position:H("top"),className:D,background:String,lockScroll:Boolean});var le=K({name:ae,props:oe,emits:["update:show"],setup(i,{emit:r,slots:c}){const o=u=>r("update:show",u);return()=>g(j,O({class:[se([i.type]),i.className],style:{color:i.color,background:i.background},overlay:!1,duration:.2,"onUpdate:show":o},F(i,re)),{default:()=>[c.default?c.default():i.message]})}});const I=q(le),ne=G("searchStore",()=>{const i=y([]),r=y([]),c=y([]),o=y([]),u=y(!1),t=y(null),p=Q(),w=async()=>{try{const a=await S.get(`${p.POST_NAME}search/history`,{withCredentials:!0}),e=[],d=new Set;for(const k of a.data)d.has(k.keyword)||(e.push(k),d.add(k.keyword));return i.value=e,e}catch(a){throw console.error("获取搜索历史失败:",a),i.value=[],a}},_=async()=>{try{const a=await S.get(`${p.POST_NAME}search/trending`);return r.value=a.data,a.data}catch(a){throw console.error("获取热搜关键词失败:",a),r.value=[],a}};return{searchHistory:i,trendingKeywords:r,petResults:c,postResults:o,loading:u,error:t,fetchSearchHistory:w,fetchTrendingKeywords:_,searchPetsAndPosts:async a=>{if(!a.trim())return c.value=[],o.value=[],{pets:[],posts:[]};u.value=!0,t.value=null;try{const[e,d]=await Promise.all([S.get(`${p.POST_NAME}search/pets`,{params:{keyword:a},withCredentials:!0}),S.get(`${p.POST_NAME}search/posts`,{params:{keyword:a},withCredentials:!0})]);return c.value=e.data,o.value=d.data,await w(),await _(),{pets:e.data,posts:d.data}}catch(e){throw console.error("搜索失败:",e),t.value="搜索失败，请稍后重试",c.value=[],o.value=[],e}finally{u.value=!1}},searchPostsByTag:async a=>{u.value=!0,t.value=null,c.value=[];try{const e=await S.get(`${p.POST_NAME}search/posts/byTag`,{params:{tagName:a},withCredentials:!0});return o.value=e.data,await w(),await _(),e.data}catch(e){throw console.error("根据标签搜索帖子失败:",e),t.value="根据标签搜索帖子失败，请稍后重试",o.value=[],e}finally{u.value=!1}},clearResults:()=>{c.value=[],o.value=[],t.value=null},resetState:()=>{i.value=[],r.value=[],c.value=[],o.value=[],u.value=!1,t.value=null}}}),ce={class:"search-container"},ie={class:"search-header"},ue={class:"content-area"},de={key:0,class:"trending-section"},he={class:"trending-tags"},ve={key:1,class:"history-section"},ye={class:"history-tags"},pe={key:2},ge={key:3,class:"result-section"},me={class:"pet-results"},fe={class:"pet-avatar"},we={class:"post-results"},_e={__name:"SearchView",setup(i){const r=y(""),c=y(0),o=y(!1),u=ee(),t=ne(),p=async()=>{if(!r.value.trim()){t.clearResults(),o.value=!1,await t.fetchSearchHistory(),await t.fetchTrendingKeywords();return}o.value=!0;try{await t.searchPetsAndPosts(r.value)}catch{I({type:"danger",message:t.error||"搜索失败，请稍后重试"})}},w=async()=>{r.value="",t.clearResults(),o.value=!1,await t.fetchSearchHistory(),await t.fetchTrendingKeywords()},_=h=>{r.value=h,p()},N=async h=>{r.value=h,o.value=!0;try{await t.searchPostsByTag(h),c.value=1}catch{I({type:"danger",message:t.error||"根据标签搜索帖子失败，请稍后重试"})}},R=h=>{u.push({name:"postdetail",params:{id:h}})};J(async()=>{await t.fetchSearchHistory(),await t.fetchTrendingKeywords()});const $=()=>{u.push("/")};return(h,a)=>(n(),v("div",ce,[a[4]||(a[4]=l("div",{class:"bg-decoration"},[l("div",{class:"bg-circle bg-circle-1"}),l("div",{class:"bg-circle bg-circle-2"}),l("div",{class:"bg-circle bg-circle-3"})],-1)),l("div",ie,[g(s(X),{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),placeholder:"请输入搜索关键词","show-action":"",onSearch:p,onCancel:w,class:"beautiful-search"},{left:m(()=>[l("div",{class:"back-button",onClick:$},[g(s(W),{name:"arrow-left",size:"18"})])]),_:1},8,["modelValue"])]),l("div",ue,[s(t).trendingKeywords.length&&!r.value?(n(),v("div",de,[a[2]||(a[2]=l("div",{class:"section-header"},[l("h3",null,"🔥 萌宠热搜")],-1)),l("div",he,[(n(!0),v(P,null,T(s(t).trendingKeywords,(e,d)=>(n(),f(s(E),{plain:"",type:"danger",size:"large",key:"trending-"+d,onClick:k=>N(e.keyword),class:"trending-tag"},{default:m(()=>[A(V(e.keyword),1)]),_:2},1032,["onClick"]))),128))])])):b("",!0),s(t).searchHistory.length&&!r.value?(n(),v("div",ve,[a[3]||(a[3]=l("div",{class:"section-header"},[l("h3",null,"📚 搜索历史")],-1)),l("div",ye,[(n(!0),v(P,null,T(s(t).searchHistory,(e,d)=>(n(),f(s(E),{plain:"",type:"primary",size:"large",key:d,onClick:k=>_(e.keyword),class:"history-tag"},{default:m(()=>[A(V(e.keyword),1)]),_:2},1032,["onClick"]))),128))])])):(n(),v("div",pe,[g(s(C),{description:"您还没有搜索记录",class:"empty-state"})])),r.value?(n(),v("div",ge,[g(s(Z),{active:c.value,"onUpdate:active":a[1]||(a[1]=e=>c.value=e),class:"result-tabs"},{default:m(()=>[g(s(x),{title:"🐾 宠物结果"},{default:m(()=>[l("div",me,[(n(!0),v(P,null,T(s(t).petResults,e=>(n(),f(s(B),{key:"pet-"+e.id,title:e.name,label:`品种：${e.species} | 年龄：${e.age}岁`,class:"pet-cell"},{icon:m(()=>[l("div",fe,[g(s(te),{width:"50",height:"50",src:e.avatar||"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg",class:"avatar-image"},null,8,["src"])])]),_:2},1032,["title","label"]))),128)),s(t).petResults.length===0&&o.value?(n(),f(s(C),{key:0,description:"🐱 未找到相关宠物",class:"empty-state"})):b("",!0)])]),_:1}),g(s(x),{title:"📝 帖子结果"},{default:m(()=>[l("div",we,[(n(!0),v(P,null,T(s(t).postResults,e=>(n(),f(s(B),{key:"post-"+e.id,title:e.title,label:`作者：${e.username} | 点赞：${e.like_count}`,onClick:d=>R(e.id),class:"post-cell"},null,8,["title","label","onClick"]))),128)),s(t).postResults.length===0&&o.value?(n(),f(s(C),{key:0,description:"📄 未找到相关帖子",class:"empty-state"})):b("",!0)])]),_:1})]),_:1},8,["active"])])):b("",!0),!r.value&&!s(t).searchHistory.length&&!s(t).trendingKeywords.length?(n(),f(s(C),{key:4,description:"🔍 暂无搜索历史或热搜",class:"empty-state"})):b("",!0)])]))}},Pe=Y(_e,[["__scopeId","data-v-a340171e"]]);export{Pe as default};

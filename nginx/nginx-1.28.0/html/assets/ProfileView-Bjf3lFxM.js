import{y as re,z as Q,A as me,B as Xe,r as D,C as E,D as J,E as Ye,H as fe,j as n,J as ge,s as Ze,K as ce,L as $,M as $e,N as Se,O as de,P as xe,Q as Ne,R as W,T as U,V as G,W as we,X as Re,i as ze,Y as he,Z as ee,$ as Ee,a0 as je,a1 as He,a2 as Oe,n as We,a3 as Ge,I as ae,a4 as Ue,a5 as Je,a6 as ie,a7 as qe,a8 as Ke,a9 as De,aa as Te,ab as Qe,ac as ea,ad as Be,ae as aa,af as ta,w as ve,ag as ye,ah as oa,_ as la,u as sa,c as X,d as m,ai as na,m as N,k as F,F as be,l as pe,aj as le,ak as ia,al as se,am as ra,t as j,e as ke,g as ca,o as Y,p as Ce,an as ua}from"./index-Dj3ETPvc.js";import{I as Fe}from"./index-DSUXiWoH.js";const _e=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),da=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),ue=ge("image-preview")[1],Ie=2.6,va={src:String,show:Boolean,active:Number,minZoom:Q(de),maxZoom:Q(de),rootWidth:Q(Number),rootHeight:Q(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var ma=re({props:va,emits:["scale","close","longPress"],setup(e,{emit:s,slots:i}){const a=me({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),f=Xe(),c=D(),k=D(),C=D(!1),_=D(!1);let x=0;const u=E(()=>{const{scale:t,moveX:r,moveY:h,moving:P,zooming:O,initializing:M}=a,oe={transitionDuration:O||P||M?"0s":".3s"};return(t!==1||_.value)&&(oe.transform=`matrix(${t}, 0, 0, ${t}, ${r}, ${h})`),oe}),y=E(()=>{if(a.imageRatio){const{rootWidth:t,rootHeight:r}=e,h=C.value?r/a.imageRatio:t;return Math.max(0,(a.scale*h-t)/2)}return 0}),d=E(()=>{if(a.imageRatio){const{rootWidth:t,rootHeight:r}=e,h=C.value?r:t*a.imageRatio;return Math.max(0,(a.scale*h-r)/2)}return 0}),l=(t,r)=>{var h;if(t=$(t,+e.minZoom,+e.maxZoom+1),t!==a.scale){const P=t/a.scale;if(a.scale=t,r){const O=xe((h=c.value)==null?void 0:h.$el),M={x:O.width*.5,y:O.height*.5},oe=a.moveX-(r.x-O.left-M.x)*(P-1),Me=a.moveY-(r.y-O.top-M.y)*(P-1);a.moveX=$(oe,-y.value,y.value),a.moveY=$(Me,-d.value,d.value)}else a.moveX=0,a.moveY=_.value?x:0;s("scale",{scale:t,index:e.active})}},v=()=>{l(1)},L=()=>{const t=a.scale>1?1:2;l(t,t===2||_.value?{x:f.startX.value,y:f.startY.value}:void 0)};let R,V,A,w,z,S,Z,q,o=!1;const g=t=>{const{touches:r}=t;if(R=r.length,R===2&&e.disableZoom)return;const{offsetX:h}=f;f.start(t),V=a.moveX,A=a.moveY,q=Date.now(),o=!1,a.moving=R===1&&(a.scale!==1||_.value),a.zooming=R===2&&!h.value,a.zooming&&(w=a.scale,z=_e(r))},I=t=>{const{touches:r}=t;if(f.move(t),a.moving){const{deltaX:h,deltaY:P}=f,O=h.value+V,M=P.value+A;if((e.vertical?f.isVertical()&&Math.abs(M)>d.value:f.isHorizontal()&&Math.abs(O)>y.value)&&!o){a.moving=!1;return}o=!0,ce(t,!0),a.moveX=$(O,-y.value,y.value),a.moveY=$(M,-d.value,d.value)}if(a.zooming&&(ce(t,!0),r.length===2)){const h=_e(r),P=w*h/z;S=da(r),l(P,S)}},b=t=>{var r;const h=(r=k.value)==null?void 0:r.$el;if(!h)return;const P=h.firstElementChild,O=t.target===h,M=P==null?void 0:P.contains(t.target);!e.closeOnClickImage&&M||!e.closeOnClickOverlay&&O||s("close")},T=t=>{if(R>1)return;const r=Date.now()-q,h=250;f.isTap.value&&(r<h?e.doubleScale?Z?(clearTimeout(Z),Z=null,L()):Z=setTimeout(()=>{b(t),Z=null},h):b(t):r>Ne&&s("longPress"))},B=t=>{let r=!1;if((a.moving||a.zooming)&&(r=!0,a.moving&&V===a.moveX&&A===a.moveY&&(r=!1),!t.touches.length)){a.zooming&&(a.moveX=$(a.moveX,-y.value,y.value),a.moveY=$(a.moveY,-d.value,d.value),a.zooming=!1),a.moving=!1,V=0,A=0,w=1,a.scale<1&&v();const h=+e.maxZoom;a.scale>h&&l(h,S)}ce(t,r),T(t),f.reset()},te=()=>{const{rootWidth:t,rootHeight:r}=e,h=r/t,{imageRatio:P}=a;C.value=a.imageRatio>h&&P<Ie,_.value=a.imageRatio>h&&P>=Ie,_.value&&(x=(P*t-r)/2,a.moveY=x,a.initializing=!0,$e(()=>{a.initializing=!1})),v()},K=t=>{const{naturalWidth:r,naturalHeight:h}=t.target;a.imageRatio=h/r,te()};return J(()=>e.active,v),J(()=>e.show,t=>{t||v()}),J(()=>[e.rootWidth,e.rootHeight],te),Ye("touchmove",I,{target:E(()=>{var t;return(t=k.value)==null?void 0:t.$el})}),fe({resetScale:v}),()=>{const t={loading:()=>n(Se,{type:"spinner"},null)};return n(Ze,{ref:k,class:ue("swipe-item"),onTouchstartPassive:g,onTouchend:B,onTouchcancel:B},{default:()=>[i.image?n("div",{class:ue("image-wrap")},[i.image({src:e.src,onLoad:K,style:u.value})]):n(Fe,{ref:c,src:e.src,fit:"contain",class:ue("image",{vertical:C.value}),style:u.value,onLoad:K},t)]})}}});const[fa,H]=ge("image-preview"),ga=["show","teleport","transition","overlayStyle","closeOnPopstate"],ha={show:Boolean,loop:U,images:Re(),minZoom:G(1/3),maxZoom:G(3),overlay:U,vertical:Boolean,closeable:Boolean,showIndex:U,className:we,closeIcon:W("clear"),transition:String,beforeClose:Function,doubleScale:U,overlayClass:we,overlayStyle:Object,swipeDuration:G(300),startPosition:G(0),showIndicators:Boolean,closeOnPopstate:U,closeOnClickImage:U,closeOnClickOverlay:U,closeIconPosition:W("top-right"),teleport:[String,Object]};var Le=re({name:fa,props:ha,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:s,slots:i}){const a=D(),f=D(),c=me({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),k=()=>{if(a.value){const w=xe(a.value.$el);c.rootWidth=w.width,c.rootHeight=w.height,a.value.resize()}},C=w=>s("scale",w),_=w=>s("update:show",w),x=()=>{Ue(e.beforeClose,{args:[c.active],done:()=>_(!1)})},u=w=>{w!==c.active&&(c.active=w,s("change",w))},y=()=>{if(e.showIndex)return n("div",{class:H("index")},[i.index?i.index({index:c.active}):`${c.active+1} / ${e.images.length}`])},d=()=>{if(i.cover)return n("div",{class:H("cover")},[i.cover()])},l=()=>{c.disableZoom=!0},v=()=>{c.disableZoom=!1},L=()=>n(We,{ref:a,lazyRender:!0,loop:e.loop,class:H("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:v,onDragStart:l},{default:()=>[e.images.map((w,z)=>n(ma,{ref:S=>{z===c.active&&(f.value=S)},src:w,show:e.show,active:c.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,disableZoom:c.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:C,onClose:x,onLongPress:()=>s("longPress",{index:z})},{image:i.image}))]}),R=()=>{if(e.closeable)return n(ae,{role:"button",name:e.closeIcon,class:[H("close-icon",e.closeIconPosition),Ge],onClick:x},null)},V=()=>s("closed"),A=(w,z)=>{var S;return(S=a.value)==null?void 0:S.swipeTo(w,z)};return fe({resetScale:()=>{var w;(w=f.value)==null||w.resetScale()},swipeTo:A}),ze(k),J([je,He],k),J(()=>e.startPosition,w=>u(+w)),J(()=>e.show,w=>{const{images:z,startPosition:S}=e;w?(u(+S),Oe(()=>{k(),A(+S,{immediate:!0})})):s("close",{index:c.active,url:z[c.active]})}),()=>n(Ee,he({class:[H(),e.className],overlayClass:[H("overlay"),e.overlayClass],onClosed:V,"onUpdate:show":_},ee(e,ga)),{default:()=>[R(),L(),y(),d()]})}});let ne;const wa={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ya(){({instance:ne}=qe({setup(){const{state:e,toggle:s}=Ke(),i=()=>{e.images=[]};return()=>n(Le,he(e,{onClosed:i,"onUpdate:show":s}),null)}}))}const ba=(e,s=0)=>{if(Je)return ne||ya(),e=Array.isArray(e)?{images:e,startPosition:s}:e,ne.open(ie({},wa,e)),ne};De(Le);const[pa,p,ka]=ge("uploader");function Pe(e,s){return new Promise(i=>{if(s==="file"){i();return}const a=new FileReader;a.onload=f=>{i(f.target.result)},s==="dataUrl"?a.readAsDataURL(e):s==="text"&&a.readAsText(e)})}function Ve(e,s){return Te(e).some(i=>i.file?Qe(s)?s(i.file):i.file.size>+s:!1)}function Ca(e,s){const i=[],a=[];return e.forEach(f=>{Ve(f,s)?a.push(f):i.push(f)}),{valid:i,invalid:a}}const _a=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,Ia=e=>_a.test(e);function Ae(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?Ia(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Pa=re({props:{name:de,item:Q(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:s,slots:i}){const a=()=>{const{status:u,message:y}=e.item;if(u==="uploading"||u==="failed"){const d=u==="failed"?n(ae,{name:"close",class:p("mask-icon")},null):n(Se,{class:p("loading")},null),l=ea(y)&&y!=="";return n("div",{class:p("mask")},[d,l&&n("div",{class:p("mask-message")},[y])])}},f=u=>{const{name:y,item:d,index:l,beforeDelete:v}=e;u.stopPropagation(),Ue(v,{args:[d,{name:y,index:l}],done:()=>s("delete")})},c=()=>s("preview"),k=()=>s("reupload"),C=()=>{if(e.deletable&&e.item.status!=="uploading"){const u=i["preview-delete"];return n("div",{role:"button",class:p("preview-delete",{shadow:!u}),tabindex:0,"aria-label":ka("delete"),onClick:f},[u?u():n(ae,{name:"cross",class:p("preview-delete-icon")},null)])}},_=()=>{if(i["preview-cover"]){const{index:u,item:y}=e;return n("div",{class:p("preview-cover")},[i["preview-cover"](ie({index:u},y))])}},x=()=>{const{item:u,lazyLoad:y,imageFit:d,previewSize:l,reupload:v}=e;return Ae(u)?n(Fe,{fit:d,src:u.objectUrl||u.content||u.url,class:p("preview-image"),width:Array.isArray(l)?l[0]:l,height:Array.isArray(l)?l[1]:l,lazyLoad:y,onClick:v?k:c},{default:_}):n("div",{class:p("file"),style:Be(e.previewSize)},[n(ae,{class:p("file-icon"),name:"description"},null),n("div",{class:[p("file-name"),"van-ellipsis"]},[u.file?u.file.name:u.url]),_()])};return()=>n("div",{class:p("preview")},[x(),a(),C()])}});const Sa={name:G(""),accept:W("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:G(1/0),imageFit:W("cover"),resultType:W("dataUrl"),uploadIcon:W("photograph"),uploadText:String,deletable:U,reupload:Boolean,afterRead:Function,showUpload:U,modelValue:Re(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:U,previewOptions:Object,previewFullImage:U,maxSize:{type:[Number,String,Function],default:1/0}};var xa=re({name:pa,props:Sa,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:s,slots:i}){const a=D(),f=[],c=D(-1),k=D(!1),C=(o=e.modelValue.length)=>({name:e.name,index:o}),_=()=>{a.value&&(a.value.value="")},x=o=>{if(_(),Ve(o,e.maxSize))if(Array.isArray(o)){const g=Ca(o,e.maxSize);if(o=g.valid,s("oversize",g.invalid,C()),!o.length)return}else{s("oversize",o,C());return}if(o=me(o),c.value>-1){const g=[...e.modelValue];g.splice(c.value,1,o),s("update:modelValue",g),c.value=-1}else s("update:modelValue",[...e.modelValue,...Te(o)]);e.afterRead&&e.afterRead(o,C())},u=o=>{const{maxCount:g,modelValue:I,resultType:b}=e;if(Array.isArray(o)){const T=+g-I.length;o.length>T&&(o=o.slice(0,T)),Promise.all(o.map(B=>Pe(B,b))).then(B=>{const te=o.map((K,t)=>{const r={file:K,status:"",message:"",objectUrl:URL.createObjectURL(K)};return B[t]&&(r.content=B[t]),r});x(te)})}else Pe(o,b).then(T=>{const B={file:o,status:"",message:"",objectUrl:URL.createObjectURL(o)};T&&(B.content=T),x(B)})},y=o=>{const{files:g}=o.target;if(e.disabled||!g||!g.length)return;const I=g.length===1?g[0]:[].slice.call(g);if(e.beforeRead){const b=e.beforeRead(I,C());if(!b){_();return}if(oa(b)){b.then(T=>{u(T||I)}).catch(_);return}}u(I)};let d;const l=()=>s("closePreview"),v=o=>{if(e.previewFullImage){const g=e.modelValue.filter(Ae),I=g.map(b=>(b.objectUrl&&!b.url&&b.status!=="failed"&&(b.url=b.objectUrl,f.push(b.url)),b.url)).filter(Boolean);d=ba(ie({images:I,startPosition:g.indexOf(o),onClose:l},e.previewOptions))}},L=()=>{d&&d.close()},R=(o,g)=>{const I=e.modelValue.slice(0);I.splice(g,1),s("update:modelValue",I),s("delete",o,C(g))},V=o=>{k.value=!0,c.value=o,Oe(()=>q())},A=()=>{k.value||(c.value=-1),k.value=!1},w=(o,g)=>{const I=["imageFit","deletable","reupload","previewSize","beforeDelete"],b=ie(ee(e,I),ee(o,I,!0));return n(Pa,he({item:o,index:g,onClick:()=>s(e.reupload?"clickReupload":"clickPreview",o,C(g)),onDelete:()=>R(o,g),onPreview:()=>v(o),onReupload:()=>V(g)},ee(e,["name","lazyLoad"]),b),ee(i,["preview-cover","preview-delete"]))},z=()=>{if(e.previewImage)return e.modelValue.map(w)},S=o=>s("clickUpload",o),Z=()=>{const o=e.modelValue.length<+e.maxCount,g=e.readonly?null:n("input",{ref:a,type:"file",class:p("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&c.value===-1,disabled:e.disabled,onChange:y,onClick:A},null);return i.default?ve(n("div",{class:p("input-wrapper"),onClick:S},[i.default(),g]),[[ye,o]]):ve(n("div",{class:p("upload",{readonly:e.readonly}),style:Be(e.previewSize),onClick:S},[n(ae,{name:e.uploadIcon,class:p("upload-icon")},null),e.uploadText&&n("span",{class:p("upload-text")},[e.uploadText]),g]),[[ye,e.showUpload&&o]])},q=()=>{a.value&&!e.disabled&&a.value.click()};return aa(()=>{f.forEach(o=>URL.revokeObjectURL(o))}),fe({chooseFile:q,reuploadFile:V,closeImagePreview:L}),ta(()=>e.modelValue),()=>n("div",{class:p()},[n("div",{class:p("wrapper",{disabled:e.disabled})},[z(),Z()])])}});const Ra=De(xa),za={class:"profile-container"},Oa={key:0,class:"profile-content"},Ua={key:"view",class:"profile-view"},Da={class:"avatar-section"},Ta={class:"avatar-container"},Ba={class:"avatar-wrapper"},Fa=["src"],La={class:"user-info-card"},Va={class:"info-icon"},Aa={class:"info-content"},Ma={class:"info-label"},Xa={class:"info-value"},Ya={class:"menu-section"},Za={key:"edit",class:"profile-edit"},$a={class:"form-container"},Na={class:"form-label"},Ea={class:"label-icon"},ja={class:"input-wrapper"},Ha=["onUpdate:modelValue","type","disabled","placeholder"],Wa={class:"button-group"},Ga={key:1,class:"loading-container"},Ja={key:2,class:"error-container"},qa={class:"error-text"},Ka={__name:"ProfileView",setup(e){const s=ca(),i=sa(),a=D(!1),f=D({username:"",email:"",avatar:"",phone:""}),c=E(()=>i.userInfo),k=E(()=>i.loading),C=E(()=>i.error),_=()=>{i.setUserInfo(null),s.push("/login")},x=d=>{},u=async()=>{try{const d=localStorage.getItem("user");if(!d){console.error("未找到用户信息"),s.push("/login");return}const l=JSON.parse(d).id,v=await i.fetchUser(l);f.value={...v.data}}catch(d){console.error("获取用户信息失败:",d)}},y=async()=>{try{const d=localStorage.getItem("user");if(!d){console.error("未找到用户信息"),s.push("/login");return}const l=JSON.parse(d).id;await i.updateUser(l,f.value),a.value=!1,await u()}catch(d){console.error("更新用户信息失败:",d)}};return ze(()=>{u()}),(d,l)=>(Y(),X("div",za,[l[9]||(l[9]=m("div",{class:"header-section"},[m("h1",{class:"page-title"},"个人中心"),m("div",{class:"title-decoration"})],-1)),c.value?(Y(),X("div",Oa,[n(ra,{name:"fade-slide",mode:"out-in"},{default:N(()=>[a.value?(Y(),X("div",Za,[l[6]||(l[6]=m("div",{class:"edit-header"},[m("h2",{class:"edit-title"},"编辑个人信息"),m("div",{class:"edit-subtitle"},"完善你的个人资料")],-1)),m("div",$a,[(Y(),X(be,null,pe([{key:"username",label:"用户名",type:"text",icon:"👤"},{key:"email",label:"邮箱",type:"email",icon:"📧"},{key:"avatar",label:"头像URL",type:"text",icon:"🖼️"},{key:"phone",label:"手机号",type:"tel",icon:"📱",disabled:!0}],(v,L)=>m("div",{class:"form-group",key:v.key,style:Ce({animationDelay:`${L*.1}s`})},[m("label",Na,[m("span",Ea,j(v.icon),1),ke(" "+j(v.label),1)]),m("div",ja,[ve(m("input",{"onUpdate:modelValue":R=>f.value[v.key]=R,type:v.type,disabled:v.disabled,class:"form-input",placeholder:`请输入${v.label}`},null,8,Ha),[[ua,f.value[v.key]]])])],4)),64))]),m("div",Wa,[n(F(le),{onClick:y,type:"primary",class:"save-btn",loading:k.value},{default:N(()=>l[4]||(l[4]=[m("span",{class:"btn-text"},"💾 保存修改",-1)])),_:1,__:[4]},8,["loading"]),n(F(le),{onClick:l[1]||(l[1]=v=>a.value=!1),type:"default",class:"cancel-btn",disabled:k.value},{default:N(()=>l[5]||(l[5]=[m("span",{class:"btn-text"},"❌取消",-1)])),_:1,__:[5]},8,["disabled"])])])):(Y(),X("div",Ua,[m("div",Da,[m("div",Ta,[n(F(Ra),{"after-read":x},{default:N(()=>[m("div",Ba,[m("img",{src:c.value.avatar||"https://img.yzcdn.cn/vant/user-default.png",class:"avatar"},null,8,Fa),l[2]||(l[2]=m("div",{class:"avatar-overlay"},[m("span",{class:"upload-text"},"点击上传")],-1))])]),_:1})])]),m("div",La,[(Y(!0),X(be,null,pe([{label:"用户名",value:c.value.username,icon:"👤"},{label:"邮箱",value:c.value.email||"未设置",icon:"📧"},{label:"手机号",value:c.value.phone,icon:"📱"}],(v,L)=>(Y(),X("div",{class:"info-item",key:v.label,style:Ce({animationDelay:`${L*.1}s`})},[m("div",Va,j(v.icon),1),m("div",Aa,[m("span",Ma,j(v.label),1),m("span",Xa,j(v.value),1)])],4))),128))]),n(F(le),{onClick:l[0]||(l[0]=v=>a.value=!0),class:"edit-btn",type:"primary",loading:k.value},{default:N(()=>l[3]||(l[3]=[m("span",{class:"btn-text"},"✏️ 编辑信息",-1)])),_:1,__:[3]},8,["loading"]),m("div",Ya,[n(F(ia),{class:"menu-group"},{default:N(()=>[n(F(se),{title:"🐾 我的宠物","is-link":"",class:"menu-item"}),n(F(se),{title:"❤️ 我的收藏","is-link":"",class:"menu-item"}),n(F(se),{title:"⚙️ 设置","is-link":"",class:"menu-item"}),n(F(se),{title:"🚪 退出登录","is-link":"",onClick:_,class:"menu-item logout-item"})]),_:1})])]))]),_:1})])):k.value?(Y(),X("div",Ga,l[7]||(l[7]=[m("div",{class:"loading-spinner"},null,-1),m("div",{class:"loading-text"},"加载中...",-1)]))):C.value?(Y(),X("div",Ja,[m("div",qa,j(C.value),1),n(F(le),{onClick:u,type:"primary"},{default:N(()=>l[8]||(l[8]=[ke("重试")])),_:1,__:[8]})])):na("",!0)]))}},at=la(Ka,[["__scopeId","data-v-8af97871"]]);export{at as default};

import{_ as L,u as N,ak as S,r as h,f as $,al as o,c as f,h as s,j as a,am as j,a as m,k as r,ai as c,aj as b,i as w,t as _,ah as k,n as V,an as A,F,l as R,ao as T,Z as E,b as g,d as G,o as i}from"./index-DPCorpo5.js";import{I as D}from"./index-C7ZXWBde.js";const M={key:0,class:"post-detail-container"},Z={class:"action-buttons"},q={class:"comment-user-info"},H={class:"comment-username"},J={class:"comment-time"},K={key:1,style:{"text-align":"center",padding:"20px"}},O={class:"comment-popup-content"},Q={__name:"PostDetailView",setup(W){const I=S();G();const C=N(),u=I.params.id,l=h(null),p=h([]),d=h(""),v=h(!1),y=async()=>{try{const e=await g.get(`http://localhost:3000/api/posts/${u}`);e.data.code===200?(Array.isArray(e.data.data)&&e.data.data.length>0?l.value=e.data.data[0]:(l.value=null,o("未找到帖子详情"),console.error("未找到帖子详情:",e.data)),console.log("帖子详情:",l.value)):(o("获取帖子详情失败: "+e.data.message),console.error("获取帖子详情失败:",e.data.message))}catch(e){o("获取帖子详情异常"),console.error("获取帖子详情异常:",e)}},x=async()=>{try{const e=await g.get(`http://localhost:3000/api/posts/${u}/comments`);e.data.code===200?(p.value=e.data.data,console.log("评论列表:",p.value)):(o("获取评论列表失败: "+e.data.message),console.error("获取评论列表失败:",e.data.message))}catch(e){o("获取评论列表异常"),console.error("获取评论列表异常:",e)}},B=async()=>{if(!d.value.trim()){o("评论内容不能为空");return}const e=C.userInfo;if(!e||!e.id){o("请先登录");return}try{const t=await g.post(`http://localhost:3000/api/posts/${u}/comments`,{userId:e.id,content:d.value.trim()});t.data.code===200?(o("评论成功"),d.value="",v.value=!1,x(),y()):(o("评论失败: "+t.data.message),console.error("评论失败:",t.data.message))}catch(t){o("评论异常"),console.error("评论异常:",t)}},P=async()=>{try{const e=await g.post(`http://localhost:3000/api/posts/${u}/like`);e.data.code===200?(o("点赞成功"),y()):(o("点赞失败: "+e.data.message),console.error("点赞失败:",e.data.message))}catch(e){o("点赞异常"),console.error("点赞异常:",e)}},U=e=>{const t=C.cachedUsers.find(n=>n.id===e);return t?t.avatar:"https://img.yzcdn.cn/vant/user-default.png"};$(()=>{u?(y(),x()):o("帖子ID缺失")});const z=()=>history.back();return(e,t)=>(i(),f("div",null,[s(a(j),{title:"帖子详情","left-text":"返回","left-arrow":"",onClickLeft:z}),l.value?(i(),f("div",M,[s(a(D),{width:"100%",height:"250",fit:"cover",src:l.value.cover_image||"placeholder.jpg"},null,8,["src"]),s(a(b),{inset:""},{default:r(()=>[s(a(c),{title:l.value.title,label:l.value.content},null,8,["title","label"]),s(a(c),{title:"发布者",value:l.value.username||"未知用户"},null,8,["value"]),s(a(c),{title:"发布时间",value:new Date(l.value.created_at).toLocaleString()},null,8,["value"]),s(a(c),{title:"点赞数",value:l.value.like_count},null,8,["value"]),s(a(c),{title:"评论数",value:l.value.comment_count},null,8,["value"])]),_:1}),m("div",Z,[s(a(k),{plain:"",type:"primary",size:"small",icon:"like-o",onClick:P},{default:r(()=>[w(" 点赞 ("+_(l.value.like_count)+") ",1)]),_:1}),s(a(k),{plain:"",type:"primary",size:"small",icon:"comment-o",onClick:t[0]||(t[0]=n=>v.value=!0)},{default:r(()=>[w(" 评论 ("+_(l.value.comment_count)+") ",1)]),_:1})]),s(a(b),{title:"评论列表",inset:""},{default:r(()=>[(i(!0),f(F,null,R(p.value,n=>(i(),V(a(c),{key:n.id,label:n.content},{title:r(()=>[m("div",q,[s(a(D),{round:"",width:"30",height:"30",src:U(n.user_id),class:"comment-avatar"},null,8,["src"]),m("span",H,_(n.username||"未知用户"),1)])]),extra:r(()=>[m("span",J,_(new Date(n.created_at).toLocaleString()),1)]),_:2},1032,["label"]))),128)),p.value.length===0?(i(),V(a(c),{key:0,title:"暂无评论"})):A("",!0)]),_:1})])):(i(),f("div",K," 加载中或帖子不存在... ")),s(a(E),{show:v.value,"onUpdate:show":t[2]||(t[2]=n=>v.value=n),position:"bottom",style:{height:"30%"}},{default:r(()=>[m("div",O,[s(a(T),{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),rows:"3",autosize:"",label:"评论内容",type:"textarea",maxlength:"200",placeholder:"请输入评论内容","show-word-limit":""},null,8,["modelValue"]),s(a(k),{type:"primary",size:"large",onClick:B},{default:r(()=>t[3]||(t[3]=[w("提交评论")])),_:1,__:[3]})])]),_:1},8,["show"])]))}},ee=L(Q,[["__scopeId","data-v-4f10b72d"]]);export{ee as default};

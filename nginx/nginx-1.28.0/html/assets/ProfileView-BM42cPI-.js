import{s as ce,x as Q,y as ge,z as Me,r as O,A as le,B as j,D as Xe,E as we,h as i,H as he,p as Ye,J as ue,K as X,L as Ze,M as Se,N as fe,O as xe,P as $e,Q as $,R as U,T as E,V as pe,W as Re,f as Oe,X as ye,Y as ee,Z as Ee,$ as Ne,a0 as je,a1 as ze,m as He,a2 as We,I as ae,a3 as Te,a4 as Ge,a5 as re,a6 as Je,a7 as qe,a8 as Ue,a9 as _e,aa as Ke,ab as Qe,ac as De,ad as ea,ae as aa,w as N,af as be,ag as ta,_ as oa,c as J,a as g,k as q,j as L,i as Y,t as de,ah as ve,ai as ne,aj as la,v as ie,b as Ce,d as na,o as K}from"./index-DPCorpo5.js";import{I as Be}from"./index-C7ZXWBde.js";const Ie=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ia=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),me=he("image-preview")[1],Pe=2.6,sa={src:String,show:Boolean,active:Number,minZoom:Q(fe),maxZoom:Q(fe),rootWidth:Q(Number),rootHeight:Q(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var ra=ce({props:sa,emits:["scale","close","longPress"],setup(e,{emit:n,slots:s}){const a=ge({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=Me(),d=O(),P=O(),C=O(!1),I=O(!1);let w=0;const t=le(()=>{const{scale:o,moveX:c,moveY:m,moving:S,zooming:T,initializing:F}=a,oe={transitionDuration:T||S||F?"0s":".3s"};return(o!==1||I.value)&&(oe.transform=`matrix(${o}, 0, 0, ${o}, ${c}, ${m})`),oe}),u=le(()=>{if(a.imageRatio){const{rootWidth:o,rootHeight:c}=e,m=C.value?c/a.imageRatio:o;return Math.max(0,(a.scale*m-o)/2)}return 0}),h=le(()=>{if(a.imageRatio){const{rootWidth:o,rootHeight:c}=e,m=C.value?c:o*a.imageRatio;return Math.max(0,(a.scale*m-c)/2)}return 0}),y=(o,c)=>{var m;if(o=X(o,+e.minZoom,+e.maxZoom+1),o!==a.scale){const S=o/a.scale;if(a.scale=o,c){const T=xe((m=d.value)==null?void 0:m.$el),F={x:T.width*.5,y:T.height*.5},oe=a.moveX-(c.x-T.left-F.x)*(S-1),Le=a.moveY-(c.y-T.top-F.y)*(S-1);a.moveX=X(oe,-u.value,u.value),a.moveY=X(Le,-h.value,h.value)}else a.moveX=0,a.moveY=I.value?w:0;n("scale",{scale:o,index:e.active})}},R=()=>{y(1)},H=()=>{const o=a.scale>1?1:2;y(o,o===2||I.value?{x:r.startX.value,y:r.startY.value}:void 0)};let B,V,A,f,z,x,M,W,l=!1;const v=o=>{const{touches:c}=o;if(B=c.length,B===2&&e.disableZoom)return;const{offsetX:m}=r;r.start(o),V=a.moveX,A=a.moveY,W=Date.now(),l=!1,a.moving=B===1&&(a.scale!==1||I.value),a.zooming=B===2&&!m.value,a.zooming&&(f=a.scale,z=Ie(c))},k=o=>{const{touches:c}=o;if(r.move(o),a.moving){const{deltaX:m,deltaY:S}=r,T=m.value+V,F=S.value+A;if((e.vertical?r.isVertical()&&Math.abs(F)>h.value:r.isHorizontal()&&Math.abs(T)>u.value)&&!l){a.moving=!1;return}l=!0,ue(o,!0),a.moveX=X(T,-u.value,u.value),a.moveY=X(F,-h.value,h.value)}if(a.zooming&&(ue(o,!0),c.length===2)){const m=Ie(c),S=f*m/z;x=ia(c),y(S,x)}},p=o=>{var c;const m=(c=P.value)==null?void 0:c.$el;if(!m)return;const S=m.firstElementChild,T=o.target===m,F=S==null?void 0:S.contains(o.target);!e.closeOnClickImage&&F||!e.closeOnClickOverlay&&T||n("close")},_=o=>{if(B>1)return;const c=Date.now()-W,m=250;r.isTap.value&&(c<m?e.doubleScale?M?(clearTimeout(M),M=null,H()):M=setTimeout(()=>{p(o),M=null},m):p(o):c>$e&&n("longPress"))},D=o=>{let c=!1;if((a.moving||a.zooming)&&(c=!0,a.moving&&V===a.moveX&&A===a.moveY&&(c=!1),!o.touches.length)){a.zooming&&(a.moveX=X(a.moveX,-u.value,u.value),a.moveY=X(a.moveY,-h.value,h.value),a.zooming=!1),a.moving=!1,V=0,A=0,f=1,a.scale<1&&R();const m=+e.maxZoom;a.scale>m&&y(m,x)}ue(o,c),_(o),r.reset()},te=()=>{const{rootWidth:o,rootHeight:c}=e,m=c/o,{imageRatio:S}=a;C.value=a.imageRatio>m&&S<Pe,I.value=a.imageRatio>m&&S>=Pe,I.value&&(w=(S*o-c)/2,a.moveY=w,a.initializing=!0,Ze(()=>{a.initializing=!1})),R()},G=o=>{const{naturalWidth:c,naturalHeight:m}=o.target;a.imageRatio=m/c,te()};return j(()=>e.active,R),j(()=>e.show,o=>{o||R()}),j(()=>[e.rootWidth,e.rootHeight],te),Xe("touchmove",k,{target:le(()=>{var o;return(o=P.value)==null?void 0:o.$el})}),we({resetScale:R}),()=>{const o={loading:()=>i(Se,{type:"spinner"},null)};return i(Ye,{ref:P,class:me("swipe-item"),onTouchstartPassive:v,onTouchend:D,onTouchcancel:D},{default:()=>[s.image?i("div",{class:me("image-wrap")},[s.image({src:e.src,onLoad:G,style:t.value})]):i(Be,{ref:d,src:e.src,fit:"contain",class:me("image",{vertical:C.value}),style:t.value,onLoad:G},o)]})}}});const[ca,Z]=he("image-preview"),ua=["show","teleport","transition","overlayStyle","closeOnPopstate"],da={show:Boolean,loop:U,images:Re(),minZoom:E(1/3),maxZoom:E(3),overlay:U,vertical:Boolean,closeable:Boolean,showIndex:U,className:pe,closeIcon:$("clear"),transition:String,beforeClose:Function,doubleScale:U,overlayClass:pe,overlayStyle:Object,swipeDuration:E(300),startPosition:E(0),showIndicators:Boolean,closeOnPopstate:U,closeOnClickImage:U,closeOnClickOverlay:U,closeIconPosition:$("top-right"),teleport:[String,Object]};var Ve=ce({name:ca,props:da,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:n,slots:s}){const a=O(),r=O(),d=ge({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),P=()=>{if(a.value){const f=xe(a.value.$el);d.rootWidth=f.width,d.rootHeight=f.height,a.value.resize()}},C=f=>n("scale",f),I=f=>n("update:show",f),w=()=>{Te(e.beforeClose,{args:[d.active],done:()=>I(!1)})},t=f=>{f!==d.active&&(d.active=f,n("change",f))},u=()=>{if(e.showIndex)return i("div",{class:Z("index")},[s.index?s.index({index:d.active}):`${d.active+1} / ${e.images.length}`])},h=()=>{if(s.cover)return i("div",{class:Z("cover")},[s.cover()])},y=()=>{d.disableZoom=!0},R=()=>{d.disableZoom=!1},H=()=>i(He,{ref:a,lazyRender:!0,loop:e.loop,class:Z("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:t,onDragEnd:R,onDragStart:y},{default:()=>[e.images.map((f,z)=>i(ra,{ref:x=>{z===d.active&&(r.value=x)},src:f,show:e.show,active:d.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:d.rootWidth,rootHeight:d.rootHeight,disableZoom:d.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:C,onClose:w,onLongPress:()=>n("longPress",{index:z})},{image:s.image}))]}),B=()=>{if(e.closeable)return i(ae,{role:"button",name:e.closeIcon,class:[Z("close-icon",e.closeIconPosition),We],onClick:w},null)},V=()=>n("closed"),A=(f,z)=>{var x;return(x=a.value)==null?void 0:x.swipeTo(f,z)};return we({resetScale:()=>{var f;(f=r.value)==null||f.resetScale()},swipeTo:A}),Oe(P),j([Ne,je],P),j(()=>e.startPosition,f=>t(+f)),j(()=>e.show,f=>{const{images:z,startPosition:x}=e;f?(t(+x),ze(()=>{P(),A(+x,{immediate:!0})})):n("close",{index:d.active,url:z[d.active]})}),()=>i(Ee,ye({class:[Z(),e.className],overlayClass:[Z("overlay"),e.overlayClass],onClosed:V,"onUpdate:show":I},ee(e,ua)),{default:()=>[B(),H(),u(),h()]})}});let se;const va={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ma(){({instance:se}=Je({setup(){const{state:e,toggle:n}=qe(),s=()=>{e.images=[]};return()=>i(Ve,ye(e,{onClosed:s,"onUpdate:show":n}),null)}}))}const fa=(e,n=0)=>{if(Ge)return se||ma(),e=Array.isArray(e)?{images:e,startPosition:n}:e,se.open(re({},va,e)),se};Ue(Ve);const[ga,b,wa]=he("uploader");function ke(e,n){return new Promise(s=>{if(n==="file"){s();return}const a=new FileReader;a.onload=r=>{s(r.target.result)},n==="dataUrl"?a.readAsDataURL(e):n==="text"&&a.readAsText(e)})}function Ae(e,n){return _e(e).some(s=>s.file?Ke(n)?n(s.file):s.file.size>+n:!1)}function ha(e,n){const s=[],a=[];return e.forEach(r=>{Ae(r,n)?a.push(r):s.push(r)}),{valid:s,invalid:a}}const ya=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,pa=e=>ya.test(e);function Fe(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?pa(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var ba=ce({props:{name:fe,item:Q(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:n,slots:s}){const a=()=>{const{status:t,message:u}=e.item;if(t==="uploading"||t==="failed"){const h=t==="failed"?i(ae,{name:"close",class:b("mask-icon")},null):i(Se,{class:b("loading")},null),y=Qe(u)&&u!=="";return i("div",{class:b("mask")},[h,y&&i("div",{class:b("mask-message")},[u])])}},r=t=>{const{name:u,item:h,index:y,beforeDelete:R}=e;t.stopPropagation(),Te(R,{args:[h,{name:u,index:y}],done:()=>n("delete")})},d=()=>n("preview"),P=()=>n("reupload"),C=()=>{if(e.deletable&&e.item.status!=="uploading"){const t=s["preview-delete"];return i("div",{role:"button",class:b("preview-delete",{shadow:!t}),tabindex:0,"aria-label":wa("delete"),onClick:r},[t?t():i(ae,{name:"cross",class:b("preview-delete-icon")},null)])}},I=()=>{if(s["preview-cover"]){const{index:t,item:u}=e;return i("div",{class:b("preview-cover")},[s["preview-cover"](re({index:t},u))])}},w=()=>{const{item:t,lazyLoad:u,imageFit:h,previewSize:y,reupload:R}=e;return Fe(t)?i(Be,{fit:h,src:t.objectUrl||t.content||t.url,class:b("preview-image"),width:Array.isArray(y)?y[0]:y,height:Array.isArray(y)?y[1]:y,lazyLoad:u,onClick:R?P:d},{default:I}):i("div",{class:b("file"),style:De(e.previewSize)},[i(ae,{class:b("file-icon"),name:"description"},null),i("div",{class:[b("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),I()])};return()=>i("div",{class:b("preview")},[w(),a(),C()])}});const Ca={name:E(""),accept:$("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:E(1/0),imageFit:$("cover"),resultType:$("dataUrl"),uploadIcon:$("photograph"),uploadText:String,deletable:U,reupload:Boolean,afterRead:Function,showUpload:U,modelValue:Re(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:U,previewOptions:Object,previewFullImage:U,maxSize:{type:[Number,String,Function],default:1/0}};var Ia=ce({name:ga,props:Ca,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:n,slots:s}){const a=O(),r=[],d=O(-1),P=O(!1),C=(l=e.modelValue.length)=>({name:e.name,index:l}),I=()=>{a.value&&(a.value.value="")},w=l=>{if(I(),Ae(l,e.maxSize))if(Array.isArray(l)){const v=ha(l,e.maxSize);if(l=v.valid,n("oversize",v.invalid,C()),!l.length)return}else{n("oversize",l,C());return}if(l=ge(l),d.value>-1){const v=[...e.modelValue];v.splice(d.value,1,l),n("update:modelValue",v),d.value=-1}else n("update:modelValue",[...e.modelValue,..._e(l)]);e.afterRead&&e.afterRead(l,C())},t=l=>{const{maxCount:v,modelValue:k,resultType:p}=e;if(Array.isArray(l)){const _=+v-k.length;l.length>_&&(l=l.slice(0,_)),Promise.all(l.map(D=>ke(D,p))).then(D=>{const te=l.map((G,o)=>{const c={file:G,status:"",message:"",objectUrl:URL.createObjectURL(G)};return D[o]&&(c.content=D[o]),c});w(te)})}else ke(l,p).then(_=>{const D={file:l,status:"",message:"",objectUrl:URL.createObjectURL(l)};_&&(D.content=_),w(D)})},u=l=>{const{files:v}=l.target;if(e.disabled||!v||!v.length)return;const k=v.length===1?v[0]:[].slice.call(v);if(e.beforeRead){const p=e.beforeRead(k,C());if(!p){I();return}if(ta(p)){p.then(_=>{t(_||k)}).catch(I);return}}t(k)};let h;const y=()=>n("closePreview"),R=l=>{if(e.previewFullImage){const v=e.modelValue.filter(Fe),k=v.map(p=>(p.objectUrl&&!p.url&&p.status!=="failed"&&(p.url=p.objectUrl,r.push(p.url)),p.url)).filter(Boolean);h=fa(re({images:k,startPosition:v.indexOf(l),onClose:y},e.previewOptions))}},H=()=>{h&&h.close()},B=(l,v)=>{const k=e.modelValue.slice(0);k.splice(v,1),n("update:modelValue",k),n("delete",l,C(v))},V=l=>{P.value=!0,d.value=l,ze(()=>W())},A=()=>{P.value||(d.value=-1),P.value=!1},f=(l,v)=>{const k=["imageFit","deletable","reupload","previewSize","beforeDelete"],p=re(ee(e,k),ee(l,k,!0));return i(ba,ye({item:l,index:v,onClick:()=>n(e.reupload?"clickReupload":"clickPreview",l,C(v)),onDelete:()=>B(l,v),onPreview:()=>R(l),onReupload:()=>V(v)},ee(e,["name","lazyLoad"]),p),ee(s,["preview-cover","preview-delete"]))},z=()=>{if(e.previewImage)return e.modelValue.map(f)},x=l=>n("clickUpload",l),M=()=>{const l=e.modelValue.length<+e.maxCount,v=e.readonly?null:i("input",{ref:a,type:"file",class:b("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&d.value===-1,disabled:e.disabled,onChange:u,onClick:A},null);return s.default?N(i("div",{class:b("input-wrapper"),onClick:x},[s.default(),v]),[[be,l]]):N(i("div",{class:b("upload",{readonly:e.readonly}),style:De(e.previewSize),onClick:x},[i(ae,{name:e.uploadIcon,class:b("upload-icon")},null),e.uploadText&&i("span",{class:b("upload-text")},[e.uploadText]),v]),[[be,e.showUpload&&l]])},W=()=>{a.value&&!e.disabled&&a.value.click()};return ea(()=>{r.forEach(l=>URL.revokeObjectURL(l))}),we({chooseFile:W,reuploadFile:V,closeImagePreview:H}),aa(()=>e.modelValue),()=>i("div",{class:b()},[i("div",{class:b("wrapper",{disabled:e.disabled})},[z(),M()])])}});const Pa=Ue(Ia),ka={class:"profile-container"},Sa={key:0,class:"profile-content"},xa={key:0,class:"profile-view"},Ra={class:"avatar-container"},Oa=["src"],za={class:"user-info"},Ta={key:1,class:"profile-edit"},Ua={class:"form-group"},_a={class:"form-group"},Da={class:"form-group"},Ba={class:"form-group"},Va={class:"button-group"},Aa={key:1,class:"loading"},Fa={__name:"ProfileView",setup(e){const n=na(),s=O(null),a=O(!1),r=O({username:"",email:"",avatar:"",phone:""}),d=()=>{localStorage.removeItem("user"),n.push("/login")},P=w=>{},C=async()=>{try{const w=JSON.parse(localStorage.getItem("user")).id,{data:t}=await Ce.get(`http://localhost:3000/api/user/${w}`);s.value=t.data,r.value={...t.data}}catch(w){console.error("获取用户信息失败:",w)}},I=async()=>{try{const w=JSON.parse(localStorage.getItem("user")).id;await Ce.put(`http://localhost:3000/api/user/${w}`,r.value),a.value=!1,await C()}catch(w){console.error("更新用户信息失败:",w)}};return Oe(()=>{C()}),(w,t)=>(K(),J("div",ka,[t[16]||(t[16]=g("h1",null,"个人中心",-1)),s.value?(K(),J("div",Sa,[a.value?(K(),J("div",Ta,[g("div",Ua,[t[10]||(t[10]=g("label",null,"用户名",-1)),N(g("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>r.value.username=u),type:"text"},null,512),[[ie,r.value.username]])]),g("div",_a,[t[11]||(t[11]=g("label",null,"邮箱",-1)),N(g("input",{"onUpdate:modelValue":t[2]||(t[2]=u=>r.value.email=u),type:"email"},null,512),[[ie,r.value.email]])]),g("div",Da,[t[12]||(t[12]=g("label",null,"头像URL",-1)),N(g("input",{"onUpdate:modelValue":t[3]||(t[3]=u=>r.value.avatar=u),type:"text"},null,512),[[ie,r.value.avatar]])]),g("div",Ba,[t[13]||(t[13]=g("label",null,"手机号",-1)),N(g("input",{"onUpdate:modelValue":t[4]||(t[4]=u=>r.value.phone=u),type:"tel",disabled:""},null,512),[[ie,r.value.phone]])]),g("div",Va,[i(L(ve),{onClick:I,type:"primary"},{default:q(()=>t[14]||(t[14]=[Y("保存")])),_:1,__:[14]}),i(L(ve),{onClick:t[5]||(t[5]=u=>a.value=!1),type:"default"},{default:q(()=>t[15]||(t[15]=[Y("取消")])),_:1,__:[15]})])])):(K(),J("div",xa,[g("div",Ra,[i(L(Pa),{"after-read":P},{default:q(()=>[g("img",{src:s.value.avatar||"https://img.yzcdn.cn/vant/user-default.png",class:"avatar"},null,8,Oa)]),_:1})]),g("div",za,[g("p",null,[t[6]||(t[6]=g("strong",null,"用户名:",-1)),Y(" "+de(s.value.username),1)]),g("p",null,[t[7]||(t[7]=g("strong",null,"邮箱:",-1)),Y(" "+de(s.value.email||"未设置"),1)]),g("p",null,[t[8]||(t[8]=g("strong",null,"手机号:",-1)),Y(" "+de(s.value.phone),1)])]),i(L(ve),{onClick:t[0]||(t[0]=u=>a.value=!0),class:"edit-btn"},{default:q(()=>t[9]||(t[9]=[Y("编辑信息")])),_:1,__:[9]}),i(L(la),null,{default:q(()=>[i(L(ne),{title:"我的宠物","is-link":""}),i(L(ne),{title:"我的收藏","is-link":""}),i(L(ne),{title:"设置","is-link":""}),i(L(ne),{title:"退出登录","is-link":"",onClick:d})]),_:1})]))])):(K(),J("div",Aa," 加载中... "))]))}},Xa=oa(Fa,[["__scopeId","data-v-ac76a4e8"]]);export{Xa as default};

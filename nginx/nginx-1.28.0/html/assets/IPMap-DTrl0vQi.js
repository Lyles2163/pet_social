import{s as E,Q as V,R as j,H,h as l,a8 as O,_ as Q,e as U,r as g,y as Z,f as q,c as N,a as i,n as P,k as n,i as m,j as s,ah as z,t as c,M as J,I as K,ai as D,aj as X,am as Y,ar as ee,F as te,l as ae,Z as oe,o as y}from"./index-DPCorpo5.js";import{T as k,E as se}from"./index-D0HrV6Mm.js";const[ne,le]=H("divider"),re={dashed:Boolean,hairline:j,vertical:Boolean,contentPosition:V("center")};var ie=E({name:ne,props:re,setup(f,{slots:w}){return()=>{var d;return l("div",{role:"separator",class:le({dashed:f.dashed,hairline:f.hairline,vertical:f.vertical,[`content-${f.contentPosition}`]:!!w.default&&!f.vertical})},[!f.vertical&&((d=w.default)==null?void 0:d.call(w))])}}});const $=O(ie),ce={class:"map-container"},de={class:"button-group"},ue={class:"weather-box"},pe={class:"weather-title"},ve={class:"weather-detail"},ge={class:"detail-item"},me={class:"detail-item"},fe={class:"detail-item"},we={class:"detail-item"},ye={class:"update-time"},_e={class:"poi-name"},he={class:"poi-address"},Ae={__name:"IPMap",setup(f){const w=U(),d=g(null),p=g(null),_=g(null),h=g(!1),r=Z({lng:"",lat:""}),A=g(""),M=g(""),C=g([]),u=g(null),b=g(!1),F=(a=[116.397428,39.90923])=>{d.value=new AMap.Map("container",{zoom:13,center:a,viewMode:"2D"})},T=a=>{p.value&&d.value.remove(p.value),p.value=new AMap.Marker({position:new AMap.LngLat(a.lng,a.lat),title:"拖动我选择位置",draggable:!0,cursor:"move"}),p.value.on("dragend",t=>{const e=t.target.getPosition();r.lng=e.getLng(),r.lat=e.getLat(),d.value.setCenter([r.lng,r.lat]),L(r.lng,r.lat),B(r.lng,r.lat)}),p.value.on("click",()=>{_.value.open(d.value,p.value.getPosition())}),d.value.add(p.value)},x=()=>{h.value=!0,A.value="",M.value="",u.value=null,AMap.plugin("AMap.Geolocation",()=>{const a=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});a.on("complete",async t=>{const e=t.position.getLng(),o=t.position.getLat();r.lng=e,r.lat=o,await L(e,o),d.value.setCenter([e,o]),T({lng:e,lat:o}),B(e,o)}),a.on("error",t=>{h.value=!1,console.error("定位失败:",t),alert("定位失败，请检查浏览器权限或网络")}),a.getCurrentPosition()})},L=async(a,t)=>{h.value=!0,AMap.plugin("AMap.Geocoder",async()=>{new AMap.Geocoder({radius:1e3,extensions:"all"}).getAddress(new AMap.LngLat(a,t),async(o,v)=>{o==="complete"&&v.regeocode?W(v.regeocode):await R(a,t),h.value=!1})})},W=a=>{A.value=a.formattedAddress,M.value=a.addressComponent.adcode,G(A.value),I(M.value)},R=async(a,t)=>{try{const e=await w.fetchAddressByRestApi(a,t);e.status==="1"&&e.regeocode&&(A.value=e.regeocode.formatted_address,M.value=e.regeocode.addressComponent.adcode,G(A.value),I(M.value))}catch(e){console.error("地址解析失败:",e)}},B=async(a,t)=>{var e;try{const o=await w.searchNearbyPoisByApi(a,t);o.status==="1"&&((e=o.pois)==null?void 0:e.length)>0&&(C.value=o.pois.map(v=>({name:v.name,address:v.address,distance:parseInt(v.distance),location:{lng:parseFloat(v.location.split(",")[0]),lat:parseFloat(v.location.split(",")[1])}})))}catch(o){console.error("周边地点搜索失败:",o)}},I=async a=>{var t;try{const e=await w.fetchWeatherByAdcode(a);if(e.status==="1"&&((t=e.lives)==null?void 0:t.length)>0){const o=e.lives[0];u.value={city:o.city,province:o.province,weather:o.weather,temperature:`${o.temperature}℃`,humidity:`${o.humidity}%`,winddirection:o.winddirection,windpower:o.windpower,reporttime:o.reporttime}}}catch(e){console.error("天气获取失败:",e)}},G=a=>{_.value||(_.value=new AMap.InfoWindow),_.value.setContent(a),p.value&&_.value.open(d.value,p.value.getPosition())},S=a=>{const{lng:t,lat:e}=a.location;r.lng=t,r.lat=e,d.value.setCenter([t,e]),p.value.setPosition(new AMap.LngLat(t,e)),L(t,e)};return q(()=>{F(),x()}),(a,t)=>(y(),N("div",ce,[l(s($),{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 16px"}},{default:n(()=>t[3]||(t[3]=[m(" 地区选择 ")])),_:1,__:[3]}),t[7]||(t[7]=i("div",{id:"container",class:"map"},null,-1)),i("div",de,[l(s(z),{type:"primary",round:"",onClick:x,icon:"location-o",class:"action-btn"},{default:n(()=>t[4]||(t[4]=[m(" 重新定位 ")])),_:1,__:[4]}),l(s(z),{type:"success",round:"",onClick:t[0]||(t[0]=e=>b.value=!0),icon:"location-o",class:"action-btn"},{default:n(()=>[m(" 周边地点 ("+c(C.value.length)+") ",1)]),_:1})]),h.value?(y(),P(s(J),{key:0,vertical:"",class:"custom-loading"},{default:n(()=>t[5]||(t[5]=[m(" 正在获取位置信息... ")])),_:1,__:[5]})):(y(),P(s(X),{key:1},{default:n(()=>[i("div",ue,[l(s($),{"content-position":"left",style:{color:"#07c160",margin:"16px 0"}},{default:n(()=>[l(s(K),{name:"weather-o",size:"20"}),t[6]||(t[6]=m(" 天气信息 "))]),_:1,__:[6]}),u.value?(y(),P(s(D),{key:0},{title:n(()=>[i("div",pe,[l(s(k),{type:"primary",size:"large"},{default:n(()=>[m(c(u.value.province),1)]),_:1}),l(s(k),{type:"success",size:"large"},{default:n(()=>[m(c(u.value.city),1)]),_:1}),l(s(k),{plain:"",type:"warning",size:"large"},{default:n(()=>[m(c(u.value.weather),1)]),_:1})])]),label:n(()=>[i("div",ve,[i("p",ge,"🌡️ 温度: "+c(u.value.temperature),1),i("p",me,"💧 湿度: "+c(u.value.humidity),1),i("p",fe,"🎐 风向: "+c(u.value.winddirection),1),i("p",we,"🌀 风力: "+c(u.value.windpower),1),i("p",ye,"🕒 "+c(u.value.reporttime),1)])]),_:1})):(y(),P(s(se),{key:1,description:"暂无天气信息"}))])]),_:1})),l(s(oe),{show:b.value,"onUpdate:show":t[2]||(t[2]=e=>b.value=e),position:"bottom",style:{height:"70%",borderRadius:"16px 16px 0 0"}},{default:n(()=>[l(s(Y),{title:"周边地点","left-text":"关闭","left-arrow":"",onClickLeft:t[1]||(t[1]=e=>b.value=!1)}),l(s(ee),{class:"poi-drawer"},{default:n(()=>[(y(!0),N(te,null,ae(C.value,(e,o)=>(y(),P(s(D),{key:o,onClick:v=>S(e)},{title:n(()=>[i("span",_e,c(e.name),1),l(s(k),{type:"danger",style:{"margin-left":"8px"}},{default:n(()=>[m(c(e.distance)+"米 ",1)]),_:2},1024)]),label:n(()=>[i("span",he,c(e.address),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["show"])]))}},be=Q(Ae,[["__scopeId","data-v-966e582a"]]);export{be as default};

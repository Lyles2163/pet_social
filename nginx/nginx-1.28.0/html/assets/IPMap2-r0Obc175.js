import{_ as U,a as V,r as m,C as j,j as q,c as x,d as s,k as r,n as i,e as w,l,al as T,t as c,P as H,x as D,I as J,an as E,am as K,at as O,au as Q,F as X,m as Y,a1 as Z,o as _}from"./index-oKQHfQLO.js";import{D as z}from"./index-BZ_QH8Qk.js";import{T as P,E as ee}from"./index-D8Sl0YT2.js";const te={class:"map-container"},ae={class:"divider-container"},se={class:"button-group"},oe={class:"btn-text"},le={key:0,class:"loading-container"},ne={key:1,class:"info-container"},ie={class:"weather-box"},re={class:"weather-title"},ce={class:"weather-detail"},de={class:"detail-item"},ue={class:"detail-value"},pe={class:"detail-item"},ve={class:"detail-value"},ge={class:"detail-item"},we={class:"detail-value"},fe={class:"detail-item"},me={class:"detail-value"},_e={class:"update-time"},ye={class:"poi-title"},he={class:"poi-name"},be={class:"poi-address"},d=23.382501,u=113.443763,Ae={__name:"IPMap2",setup(ke){const y=V(),p=m(null),v=m(null),h=m(null),b=m(!1),n=j({lng:"",lat:""}),k=m(""),C=m(""),I=m([]),g=m(null),L=m(!1),W=(a=[u,d])=>{p.value=new AMap.Map("container",{zoom:13,center:a,viewMode:"2D"})},B=a=>{v.value&&p.value.remove(v.value),v.value=new AMap.Marker({position:new AMap.LngLat(a.lng,a.lat),title:"拖动我选择位置",draggable:!0,cursor:"move"}),v.value.on("dragend",e=>{const t=e.target.getPosition();n.lng=t.getLng(),n.lat=t.getLat(),p.value.setCenter([n.lng,n.lat]),A(n.lng,n.lat),M(n.lng,n.lat)}),v.value.on("click",()=>{h.value.open(p.value,v.value.getPosition())}),p.value.add(v.value)},G=async()=>{b.value=!0;try{const a=await y.fetchClientIp();if(!a)throw new Error("无法获取客户端IP");const e=await y.fetchIpLocation(a);if(e.status==="1"){const[t,o]=e.rectangle.split(";")[0].split(",").map(Number);n.lng=t,n.lat=o,p.value.setCenter([t,o]),B({lng:t,lat:o}),await A(t,o),M(t,o)}else console.warn("IP定位失败，使用默认坐标:",{lng:u,lat:d}),n.lng=u,n.lat=d,p.value.setCenter([u,d]),B({lng:u,lat:d}),await A(u,d),M(u,d)}catch(a){console.error("定位异常:",a),n.lng=u,n.lat=d,p.value.setCenter([u,d]),B({lng:u,lat:d}),await A(u,d),M(u,d)}finally{b.value=!1}},A=async(a,e)=>{b.value=!0,AMap.plugin("AMap.Geocoder",async()=>{new AMap.Geocoder({radius:1e3,extensions:"all"}).getAddress(new AMap.LngLat(a,e),async(o,f)=>{o==="complete"&&f.regeocode?$(f.regeocode):await R(a,e),b.value=!1})})},$=a=>{k.value=a.formattedAddress,C.value=a.addressComponent.adcode,F(k.value),N(C.value)},R=async(a,e)=>{try{const t=await y.fetchAddressByRestApi(a,e);t.status==="1"&&t.regeocode&&(k.value=t.regeocode.formatted_address,C.value=t.regeocode.addressComponent.adcode,F(k.value),N(C.value))}catch(t){console.error("地址解析失败:",t)}},M=async(a,e)=>{var t;try{const o=await y.searchNearbyPoisByApi(a,e);o.status==="1"&&((t=o.pois)==null?void 0:t.length)>0&&(I.value=o.pois.map(f=>({name:f.name,address:f.address,distance:parseInt(f.distance),location:{lng:parseFloat(f.location.split(",")[0]),lat:parseFloat(f.location.split(",")[1])}})))}catch(o){console.error("周边地点搜索失败:",o)}},N=async a=>{var e;try{const t=await y.fetchWeatherByAdcode(a);if(t.status==="1"&&((e=t.lives)==null?void 0:e.length)>0){const o=t.lives[0];g.value={city:o.city,province:o.province,weather:o.weather,temperature:`${o.temperature}℃`,humidity:`${o.humidity}%`,winddirection:o.winddirection,windpower:o.windpower,reporttime:o.reporttime}}}catch(t){console.error("天气获取失败:",t)}},F=a=>{h.value||(h.value=new AMap.InfoWindow),h.value.setContent(a),v.value&&h.value.open(p.value,v.value.getPosition())},S=a=>{const{lng:e,lat:t}=a.location;n.lng=e,n.lat=t,p.value.setCenter([e,t]),v.value.setPosition(new AMap.LngLat(e,t)),A(e,t)};return q(()=>{W(),G()}),(a,e)=>(_(),x("div",te,[e[11]||(e[11]=s("div",{class:"bg-decoration"},[s("div",{class:"bg-circle bg-circle-1"}),s("div",{class:"bg-circle bg-circle-2"}),s("div",{class:"bg-circle bg-circle-3"})],-1)),s("div",ae,[r(l(z),{style:{color:"#667eea",borderColor:"#667eea",padding:"0 16px"},class:"beautiful-divider"},{default:i(()=>e[3]||(e[3]=[w(" 🗺️ 地区选择 ")])),_:1,__:[3]})]),e[12]||(e[12]=s("div",{class:"map-wrapper"},[s("div",{id:"container",class:"map"})],-1)),s("div",se,[r(l(T),{type:"primary",round:"",onClick:G,icon:"location-o",class:"action-btn location-btn"},{default:i(()=>e[4]||(e[4]=[s("span",{class:"btn-text"},"📍 重新定位",-1)])),_:1,__:[4]}),r(l(T),{type:"success",round:"",onClick:e[0]||(e[0]=t=>L.value=!0),icon:"location-o",class:"action-btn poi-btn"},{default:i(()=>[s("span",oe,"🏪 周边地点 ("+c(I.value.length)+")",1)]),_:1})]),b.value?(_(),x("div",le,[r(l(H),{vertical:"",class:"custom-loading"},{default:i(()=>e[5]||(e[5]=[s("div",{class:"loading-text"},"🌍 正在获取位置信息...",-1)])),_:1,__:[5]})])):(_(),x("div",ne,[r(l(K),{class:"info-group"},{default:i(()=>[s("div",ie,[r(l(z),{"content-position":"left",style:{color:"#07c160",margin:"16px 0"},class:"weather-divider"},{default:i(()=>[r(l(J),{name:"weather-o",size:"20",class:"weather-icon"}),e[6]||(e[6]=w(" 🌤️ 天气信息 "))]),_:1,__:[6]}),g.value?(_(),D(l(E),{key:0,class:"weather-cell"},{title:i(()=>[s("div",re,[r(l(P),{type:"primary",size:"large",class:"location-tag"},{default:i(()=>[w(c(g.value.province),1)]),_:1}),r(l(P),{type:"success",size:"large",class:"location-tag"},{default:i(()=>[w(c(g.value.city),1)]),_:1}),r(l(P),{plain:"",type:"warning",size:"large",class:"weather-tag"},{default:i(()=>[w(c(g.value.weather),1)]),_:1})])]),label:i(()=>[s("div",ce,[s("p",de,[e[7]||(e[7]=w("🌡️ 温度: ")),s("span",ue,c(g.value.temperature),1)]),s("p",pe,[e[8]||(e[8]=w("💧 湿度: ")),s("span",ve,c(g.value.humidity),1)]),s("p",ge,[e[9]||(e[9]=w("🎐 风向: ")),s("span",we,c(g.value.winddirection),1)]),s("p",fe,[e[10]||(e[10]=w("🌀 风力: ")),s("span",me,c(g.value.windpower),1)]),s("p",_e,"🕒 "+c(g.value.reporttime),1)])]),_:1})):(_(),D(l(ee),{key:1,description:"🌫️ 暂无天气信息",class:"empty-state"}))])]),_:1})])),r(l(Z),{show:L.value,"onUpdate:show":e[2]||(e[2]=t=>L.value=t),position:"bottom",style:{height:"70%",borderRadius:"20px 20px 0 0"},class:"poi-popup"},{default:i(()=>[r(l(O),{title:"🏪 周边地点","left-text":"关闭","left-arrow":"",onClickLeft:e[1]||(e[1]=t=>L.value=!1),class:"poi-nav-bar"}),r(l(Q),{class:"poi-drawer"},{default:i(()=>[(_(!0),x(X,null,Y(I.value,(t,o)=>(_(),D(l(E),{key:o,onClick:f=>S(t),class:"poi-cell"},{title:i(()=>[s("div",ye,[s("span",he,"📍 "+c(t.name),1),r(l(P),{type:"danger",class:"distance-tag"},{default:i(()=>[w(c(t.distance)+"米 ",1)]),_:2},1024)])]),label:i(()=>[s("span",be,"🏠 "+c(t.address),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["show"])]))}},xe=U(Ae,[["__scopeId","data-v-f812fddd"]]);export{xe as default};

import{y as K,a6 as M,J as O,j as f,Y as z,Z as F,$ as j,ay as U,W as q,R as H,O as D,a9 as G,ax as J,r as v,a as L,f as b,_ as W,i as Y,c as p,d as l,m as g,k as s,I as Z,S as Q,ai as w,q as m,F as P,l as T,az as x,aA as X,g as ee,o as n,e as A,t as V,al as B}from"./index-Dj3ETPvc.js";import{E as C,T as E}from"./index-le55krO_.js";import{I as te}from"./index-DSUXiWoH.js";const[ae,se]=O("notify"),re=["lockScroll","position","show","teleport","zIndex"],oe=M({},U,{type:H("danger"),color:String,message:D,position:H("top"),className:q,background:String,lockScroll:Boolean});var le=K({name:ae,props:oe,emits:["update:show"],setup(i,{emit:r,slots:c}){const o=u=>r("update:show",u);return()=>f(j,z({class:[se([i.type]),i.className],style:{color:i.color,background:i.background},overlay:!1,duration:.2,"onUpdate:show":o},F(i,re)),{default:()=>[c.default?c.default():i.message]})}});const I=G(le),ne=J("searchStore",()=>{const i=v([]),r=v([]),c=v([]),o=v([]),u=v(!1),t=v(null),y=L(),_=async()=>{try{const a=await b.get(`${y.POST_NAME}search/history`,{withCredentials:!0}),e=[],d=new Set;for(const S of a.data)d.has(S.keyword)||(e.push(S),d.add(S.keyword));return i.value=e,e}catch(a){throw console.error("获取搜索历史失败:",a),i.value=[],a}},k=async()=>{try{const a=await b.get(`${y.POST_NAME}search/trending`);return r.value=a.data,a.data}catch(a){throw console.error("获取热搜关键词失败:",a),r.value=[],a}};return{searchHistory:i,trendingKeywords:r,petResults:c,postResults:o,loading:u,error:t,fetchSearchHistory:_,fetchTrendingKeywords:k,searchPetsAndPosts:async a=>{if(!a.trim())return c.value=[],o.value=[],{pets:[],posts:[]};u.value=!0,t.value=null;try{const[e,d]=await Promise.all([b.get(`${y.POST_NAME}search/pets`,{params:{keyword:a},withCredentials:!0}),b.get(`${y.POST_NAME}search/posts`,{params:{keyword:a},withCredentials:!0})]);return c.value=e.data,o.value=d.data,await _(),await k(),{pets:e.data,posts:d.data}}catch(e){throw console.error("搜索失败:",e),t.value="搜索失败，请稍后重试",c.value=[],o.value=[],e}finally{u.value=!1}},searchPostsByTag:async a=>{u.value=!0,t.value=null,c.value=[];try{const e=await b.get(`${y.POST_NAME}search/posts/byTag`,{params:{tagName:a},withCredentials:!0});return o.value=e.data,await _(),await k(),e.data}catch(e){throw console.error("根据标签搜索帖子失败:",e),t.value="根据标签搜索帖子失败，请稍后重试",o.value=[],e}finally{u.value=!1}},clearResults:()=>{c.value=[],o.value=[],t.value=null},resetState:()=>{i.value=[],r.value=[],c.value=[],o.value=[],u.value=!1,t.value=null}}}),ce={class:"search-container"},ie={class:"search-header"},ue={class:"content-area"},de={key:0,class:"history-section"},he={class:"history-tags"},ve={key:1,class:"trending-section"},ye={class:"trending-tags"},pe={key:2,class:"result-section"},ge={class:"pet-results"},me={class:"pet-avatar"},fe={class:"post-results"},we={__name:"SearchView",setup(i){const r=v(""),c=v(0),o=v(!1),u=ee(),t=ne(),y=async()=>{if(!r.value.trim()){t.clearResults(),o.value=!1,await t.fetchSearchHistory(),await t.fetchTrendingKeywords();return}o.value=!0;try{await t.searchPetsAndPosts(r.value)}catch{I({type:"danger",message:t.error||"搜索失败，请稍后重试"})}},_=async()=>{r.value="",t.clearResults(),o.value=!1,await t.fetchSearchHistory(),await t.fetchTrendingKeywords()},k=h=>{r.value=h,y()},R=async h=>{r.value=h,o.value=!0;try{await t.searchPostsByTag(h),c.value=1}catch{I({type:"danger",message:t.error||"根据标签搜索帖子失败，请稍后重试"})}},N=h=>{u.push({name:"postdetail",params:{id:h}})};Y(async()=>{await t.fetchSearchHistory(),await t.fetchTrendingKeywords()});const $=()=>{u.push("/")};return(h,a)=>(n(),p("div",ce,[a[4]||(a[4]=l("div",{class:"bg-decoration"},[l("div",{class:"bg-circle bg-circle-1"}),l("div",{class:"bg-circle bg-circle-2"}),l("div",{class:"bg-circle bg-circle-3"})],-1)),l("div",ie,[f(s(Q),{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),placeholder:"请输入搜索关键词","show-action":"",onSearch:y,onCancel:_,class:"beautiful-search"},{left:g(()=>[l("div",{class:"back-button",onClick:$},[f(s(Z),{name:"arrow-left",size:"18"})])]),_:1},8,["modelValue"])]),l("div",ue,[s(t).searchHistory.length&&!r.value?(n(),p("div",de,[a[2]||(a[2]=l("div",{class:"section-header"},[l("h3",null,"📚 搜索历史")],-1)),l("div",he,[(n(!0),p(P,null,T(s(t).searchHistory,(e,d)=>(n(),m(s(E),{plain:"",type:"primary",size:"large",key:d,onClick:S=>k(e.keyword),class:"history-tag"},{default:g(()=>[A(V(e.keyword),1)]),_:2},1032,["onClick"]))),128))])])):w("",!0),s(t).trendingKeywords.length&&!r.value?(n(),p("div",ve,[a[3]||(a[3]=l("div",{class:"section-header"},[l("h3",null,"🔥 萌宠热搜")],-1)),l("div",ye,[(n(!0),p(P,null,T(s(t).trendingKeywords,(e,d)=>(n(),m(s(E),{plain:"",type:"danger",size:"large",key:"trending-"+d,onClick:S=>R(e.keyword),class:"trending-tag"},{default:g(()=>[A(V(e.keyword),1)]),_:2},1032,["onClick"]))),128))])])):w("",!0),r.value?(n(),p("div",pe,[f(s(X),{active:c.value,"onUpdate:active":a[1]||(a[1]=e=>c.value=e),class:"result-tabs"},{default:g(()=>[f(s(x),{title:"🐾 宠物结果"},{default:g(()=>[l("div",ge,[(n(!0),p(P,null,T(s(t).petResults,e=>(n(),m(s(B),{key:"pet-"+e.id,title:e.name,label:`品种：${e.species} | 年龄：${e.age}岁`,class:"pet-cell"},{icon:g(()=>[l("div",me,[f(s(te),{width:"50",height:"50",src:e.avatar||"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg",class:"avatar-image"},null,8,["src"])])]),_:2},1032,["title","label"]))),128)),s(t).petResults.length===0&&o.value?(n(),m(s(C),{key:0,description:"🐱 未找到相关宠物",class:"empty-state"})):w("",!0)])]),_:1}),f(s(x),{title:"📝 帖子结果"},{default:g(()=>[l("div",fe,[(n(!0),p(P,null,T(s(t).postResults,e=>(n(),m(s(B),{key:"post-"+e.id,title:e.title,label:`作者：${e.username} | 点赞：${e.like_count}`,onClick:d=>N(e.id),class:"post-cell"},null,8,["title","label","onClick"]))),128)),s(t).postResults.length===0&&o.value?(n(),m(s(C),{key:0,description:"📄 未找到相关帖子",class:"empty-state"})):w("",!0)])]),_:1})]),_:1},8,["active"])])):w("",!0),!r.value&&!s(t).searchHistory.length&&!s(t).trendingKeywords.length?(n(),m(s(C),{key:3,description:"🔍 暂无搜索历史或热搜",class:"empty-state"})):w("",!0)])]))}},be=W(we,[["__scopeId","data-v-17307902"]]);export{be as default};

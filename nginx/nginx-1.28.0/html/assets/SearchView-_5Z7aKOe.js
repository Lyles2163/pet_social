import{s as U,a5 as K,H as q,h as m,X as D,Y as L,Z as M,as as Q,V as X,Q as T,N as Y,a8 as Z,_ as A,r as p,f as G,c,an as y,n as h,j as o,S as J,a as S,F as C,l as b,k as g,at as x,au as O,b as _,o as s,i as I,t as $,ai as B}from"./index-DPCorpo5.js";import{E as P,T as H}from"./index-D0HrV6Mm.js";import{I as W}from"./index-C7ZXWBde.js";const[ee,ae]=q("notify"),te=["lockScroll","position","show","teleport","zIndex"],se=K({},Q,{type:T("danger"),color:String,message:Y,position:T("top"),className:X,background:String,lockScroll:Boolean});var re=U({name:ee,props:se,emits:["update:show"],setup(i,{emit:r,slots:l}){const n=u=>r("update:show",u);return()=>m(M,D({class:[ae([i.type]),i.className],style:{color:i.color,background:i.background},overlay:!1,duration:.2,"onUpdate:show":n},L(i,te)),{default:()=>[l.default?l.default():i.message]})}});const F=Z(re),oe={class:"search-container"},le={key:0,class:"history-section"},ne={class:"history-tags"},ce={key:1,class:"trending-section"},ie={class:"trending-tags"},ue={key:2,class:"result-section"},de={__name:"SearchView",setup(i){const r=p(""),l=p([]),n=p([]),u=p([]),k=p([]),N=p(0),v=p(!1),f=async()=>{try{const a=await _.get("http://localhost:3000/api/search/history",{withCredentials:!0}),t=[],e=new Set;for(const d of a.data)e.has(d.keyword)||(t.push(d),e.add(d.keyword));u.value=t}catch(a){console.error("获取搜索历史失败:",a),u.value=[]}},w=async()=>{try{const a=await _.get("http://localhost:3000/api/search/trending");k.value=a.data}catch(a){console.error("获取热搜关键词失败:",a),k.value=[]}},V=async()=>{if(!r.value.trim()){l.value=[],n.value=[],v.value=!1,f(),w();return}v.value=!0;try{const[a,t]=await Promise.all([_.get("http://localhost:3000/api/search/pets",{params:{keyword:r.value},withCredentials:!0}),_.get("http://localhost:3000/api/search/posts",{params:{keyword:r.value},withCredentials:!0})]);l.value=a.data,n.value=t.data,f(),w()}catch(a){console.error("搜索失败:",a),F({type:"danger",message:"搜索失败，请稍后重试"}),l.value=[],n.value=[]}},R=()=>{r.value="",l.value=[],n.value=[],v.value=!1,f(),w()},j=a=>{r.value=a,V()},z=async a=>{r.value=a,v.value=!0,l.value=[];try{const t=await _.get("http://localhost:3000/api/search/posts/byTag",{params:{tagName:a},withCredentials:!0});n.value=t.data,N.value=1,f(),w()}catch(t){console.error("根据标签搜索帖子失败:",t),F({type:"danger",message:"根据标签搜索帖子失败，请稍后重试"}),n.value=[]}};return G(()=>{f(),w()}),(a,t)=>(s(),c("div",oe,[m(o(J),{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),placeholder:"请输入搜索关键词","show-action":"",onSearch:V,onCancel:R},null,8,["modelValue"]),u.value.length&&!r.value?(s(),c("div",le,[t[2]||(t[2]=S("h3",null,"搜索历史",-1)),S("div",ne,[(s(!0),c(C,null,b(u.value,(e,d)=>(s(),h(o(H),{plain:"",type:"primary",size:"large",key:d,onClick:E=>j(e.keyword)},{default:g(()=>[I($(e.keyword),1)]),_:2},1032,["onClick"]))),128))])])):y("",!0),k.value.length&&!r.value?(s(),c("div",ce,[t[3]||(t[3]=S("h3",null,"萌宠热搜",-1)),S("div",ie,[(s(!0),c(C,null,b(k.value,(e,d)=>(s(),h(o(H),{plain:"",type:"danger",size:"large",key:"trending-"+d,onClick:E=>z(e.keyword)},{default:g(()=>[I($(e.keyword),1)]),_:2},1032,["onClick"]))),128))])])):y("",!0),r.value?(s(),c("div",ue,[m(o(O),{active:N.value,"onUpdate:active":t[1]||(t[1]=e=>N.value=e)},{default:g(()=>[m(o(x),{title:"宠物结果"},{default:g(()=>[(s(!0),c(C,null,b(l.value,e=>(s(),h(o(B),{key:"pet-"+e.id,title:e.name,label:`品种：${e.species} | 年龄：${e.age}岁`},{icon:g(()=>[m(o(W),{width:"50",height:"50",src:e.avatar||"https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg"},null,8,["src"])]),_:2},1032,["title","label"]))),128)),l.value.length===0&&v.value?(s(),h(o(P),{key:0,description:"未找到相关宠物"})):y("",!0)]),_:1}),m(o(x),{title:"帖子结果"},{default:g(()=>[(s(!0),c(C,null,b(n.value,e=>(s(),h(o(B),{key:"post-"+e.id,title:e.title,label:`作者：${e.username} | 点赞：${e.like_count}`},null,8,["title","label"]))),128)),n.value.length===0&&v.value?(s(),h(o(P),{key:0,description:"未找到相关帖子"})):y("",!0)]),_:1})]),_:1},8,["active"])])):y("",!0),!r.value&&!u.value.length&&!k.value.length?(s(),h(o(P),{key:3,description:"暂无搜索历史或热搜"})):y("",!0)]))}},ye=A(de,[["__scopeId","data-v-88e91c11"]]);export{ye as default};

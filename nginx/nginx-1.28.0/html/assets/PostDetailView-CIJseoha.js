import{_ as U,u as V,h as z,ao as A,r as d,i as B,c as i,d as s,ai as D,t as l,ap as S,F as E,l as N,w as F,v as R,aq as j,f as y,g as q,o as r,p as G}from"./index-Dj3ETPvc.js";const H={class:"post-detail-page"},J={key:0,class:"post-detail-container"},K={class:"post-cover-container"},O=["src","alt"],Q={class:"cover-overlay"},W={class:"post-title"},X={class:"post-info-card"},Y={class:"post-meta"},Z={class:"author-info"},ss=["src","alt"],ts={class:"author-details"},es={class:"author-name"},os={class:"post-time"},as={class:"post-stats"},ns={class:"stat-item"},ls={class:"stat-item"},is={class:"post-content"},rs={class:"action-buttons"},cs={class:"btn-icon"},ds={class:"comments-section"},us={class:"section-header"},vs={class:"comment-count"},ms={class:"comments-list"},ps=["src","alt"],_s={class:"comment-content"},hs={class:"comment-header"},fs={class:"comment-username"},gs={class:"comment-time"},ys={class:"comment-text"},bs={key:0,class:"empty-comments"},ks={key:1,class:"loading-container"},ws={class:"popup-header"},Cs={class:"popup-content"},xs={class:"input-footer"},$s={class:"char-count"},Ds=["disabled"],Ss={key:0},Ps={key:1},Ls={__name:"PostDetailView",setup(Ms){const P=A();q();const b=V(),L=z(),u=P.params.id,a=d(null),v=d([]),c=d(""),m=d(!1),h=d(!1),p=d(!1),n=(e,t="info")=>{const o=document.createElement("div");o.className=`toast toast-${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{document.body.removeChild(o)},300)},3e3)},f=async()=>{try{const e=await y.get(`http://localhost:3000/api/posts/${u}`);e.data.code===200?(Array.isArray(e.data.data)&&e.data.data.length>0?a.value=e.data.data[0]:(a.value=null,n("æœªæ‰¾åˆ°å¸–å­è¯¦æƒ…","error"),console.error("æœªæ‰¾åˆ°å¸–å­è¯¦æƒ…:",e.data)),console.log("å¸–å­è¯¦æƒ…:",a.value)):(n("è·å–å¸–å­è¯¦æƒ…å¤±è´¥: "+e.data.message,"error"),console.error("è·å–å¸–å­è¯¦æƒ…å¤±è´¥:",e.data.message))}catch(e){n("è·å–å¸–å­è¯¦æƒ…å¼‚å¸¸","error"),console.error("è·å–å¸–å­è¯¦æƒ…å¼‚å¸¸:",e)}},k=async()=>{try{const e=await y.get(`http://localhost:3000/api/posts/${u}/comments`);e.data.code===200?(v.value=e.data.data,console.log("è¯„è®ºåˆ—è¡¨:",v.value)):(n("è·å–è¯„è®ºåˆ—è¡¨å¤±è´¥: "+e.data.message,"error"),console.error("è·å–è¯„è®ºåˆ—è¡¨å¤±è´¥:",e.data.message))}catch(e){n("è·å–è¯„è®ºåˆ—è¡¨å¼‚å¸¸","error"),console.error("è·å–è¯„è®ºåˆ—è¡¨å¼‚å¸¸:",e)}},M=async()=>{if(!c.value.trim()){n("è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º","warning");return}const e=b.userInfo;if(!e||!e.id){n("è¯·å…ˆç™»å½•","warning");return}p.value=!0;try{const t=await y.post(`http://localhost:3000/api/posts/${u}/comments`,{userId:e.id,content:c.value.trim()});t.data.code===200?(n("è¯„è®ºæˆåŠŸ","success"),c.value="",m.value=!1,k(),f()):(n("è¯„è®ºå¤±è´¥: "+t.data.message,"error"),console.error("è¯„è®ºå¤±è´¥:",t.data.message))}catch(t){n("è¯„è®ºå¼‚å¸¸","error"),console.error("è¯„è®ºå¼‚å¸¸:",t)}finally{p.value=!1}},T=async()=>{try{const e=await L.likePost(u);e.code===200?(n("ç‚¹èµæˆåŠŸ","success"),h.value=!0,f()):(n("ç‚¹èµå¤±è´¥: "+e.message,"error"),console.error("ç‚¹èµå¤±è´¥:",e.message))}catch(e){n("ç‚¹èµå¼‚å¸¸","error"),console.error("ç‚¹èµå¼‚å¸¸:",e)}},w=e=>{const t=b.cachedUsers.find(o=>o.id===e);return t?t.avatar:"https://img.yzcdn.cn/vant/user-default.png"},C=e=>{const t=new Date(e),_=new Date-t,g=Math.floor(_/6e4),x=Math.floor(_/36e5),$=Math.floor(_/864e5);return g<1?"åˆšåˆš":g<60?`${g}åˆ†é’Ÿå‰`:x<24?`${x}å°æ—¶å‰`:$<7?`${$}å¤©å‰`:t.toLocaleDateString()};B(()=>{u?(f(),k()):n("å¸–å­IDç¼ºå¤±","error")});const I=()=>history.back();return(e,t)=>(r(),i("div",H,[t[19]||(t[19]=s("div",{class:"gradient-strip"},null,-1)),s("div",{class:"nav-bar"},[s("button",{class:"back-btn",onClick:I},t[6]||(t[6]=[s("i",{class:"icon"},"â†",-1),s("span",null,"è¿”å›",-1)])),t[7]||(t[7]=s("h1",{class:"nav-title"},"ğŸ“– å¸–å­è¯¦æƒ…",-1)),t[8]||(t[8]=s("div",{class:"nav-placeholder"},null,-1))]),a.value?(r(),i("div",J,[s("div",K,[s("img",{class:"post-cover",src:a.value.cover_image||"placeholder.jpg",alt:a.value.title,onError:t[0]||(t[0]=o=>o.target.src="https://via.placeholder.com/400x250/f0f0f0/999?text=æš‚æ— å›¾ç‰‡")},null,40,O),s("div",Q,[s("h2",W,l(a.value.title),1)])]),s("div",X,[s("div",Y,[s("div",Z,[s("img",{class:"author-avatar",src:w(a.value.user_id),alt:a.value.username},null,8,ss),s("div",ts,[s("span",es,l(a.value.username||"æœªçŸ¥ç”¨æˆ·"),1),s("span",os,l(C(a.value.created_at)),1)])]),s("div",as,[s("div",ns,[t[9]||(t[9]=s("i",{class:"stat-icon"},"ğŸ‘",-1)),s("span",null,l(a.value.like_count),1)]),s("div",ls,[t[10]||(t[10]=s("i",{class:"stat-icon"},"ğŸ’¬",-1)),s("span",null,l(a.value.comment_count),1)])])]),s("div",is,[s("p",null,l(a.value.content),1)])]),s("div",rs,[s("button",{class:S(["action-btn like-btn",{liked:h.value}]),onClick:T},[s("i",cs,l(h.value?"â¤ï¸":"ğŸ¤"),1),s("span",null,"ç‚¹èµ ("+l(a.value.like_count)+")",1),t[11]||(t[11]=s("div",{class:"ripple"},null,-1))],2),s("button",{class:"action-btn comment-btn",onClick:t[1]||(t[1]=o=>m.value=!0)},[t[12]||(t[12]=s("i",{class:"btn-icon"},"ğŸ’¬",-1)),s("span",null,"è¯„è®º ("+l(a.value.comment_count)+")",1),t[13]||(t[13]=s("div",{class:"ripple"},null,-1))])]),s("div",ds,[s("div",us,[t[14]||(t[14]=s("h3",null,"ğŸ’­ è¯„è®ºåˆ—è¡¨",-1)),s("span",vs,l(v.value.length)+"æ¡è¯„è®º",1)]),s("div",ms,[(r(!0),i(E,null,N(v.value,(o,_)=>(r(),i("div",{key:o.id,class:"comment-item",style:G({animationDelay:`${_*.1}s`})},[s("img",{class:"comment-avatar",src:w(o.user_id),alt:o.username},null,8,ps),s("div",_s,[s("div",hs,[s("span",fs,l(o.username||"æœªçŸ¥ç”¨æˆ·"),1),s("span",gs,l(C(o.created_at)),1)]),s("p",ys,l(o.content),1)])],4))),128)),v.value.length===0?(r(),i("div",bs,t[15]||(t[15]=[s("i",{class:"empty-icon"},"ğŸ’­",-1),s("p",null,"è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼",-1)]))):D("",!0)])])])):(r(),i("div",ks,t[16]||(t[16]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"åŠ è½½ä¸­...",-1)]))),m.value?(r(),i("div",{key:2,class:"comment-popup-overlay",onClick:t[5]||(t[5]=o=>m.value=!1)},[s("div",{class:"comment-popup",onClick:t[4]||(t[4]=j(()=>{},["stop"]))},[s("div",ws,[t[17]||(t[17]=s("h3",null,"âœï¸ å†™è¯„è®º",-1)),s("button",{class:"close-btn",onClick:t[2]||(t[2]=o=>m.value=!1)},"âœ•")]),s("div",Cs,[F(s("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>c.value=o),class:"comment-input",placeholder:"åˆ†äº«ä½ çš„æƒ³æ³•...",maxlength:"200",rows:"4"},null,512),[[R,c.value]]),s("div",xs,[s("span",$s,l(c.value.length)+"/200",1)]),s("button",{class:S(["submit-btn",{loading:p.value}]),disabled:p.value||!c.value.trim(),onClick:M},[p.value?(r(),i("span",Ps,"å‘å¸ƒä¸­...")):(r(),i("span",Ss,"å‘å¸ƒè¯„è®º")),t[18]||(t[18]=s("div",{class:"ripple"},null,-1))],10,Ds)])])])):D("",!0),t[20]||(t[20]=s("div",{class:"bottom-decoration"},[s("div",{class:"decoration-text"},"âœ¨ åˆ†äº«ç²¾å½©ç¬é—´ âœ¨")],-1))]))}},Is=U(Ls,[["__scopeId","data-v-567a53eb"]]);export{Is as default};

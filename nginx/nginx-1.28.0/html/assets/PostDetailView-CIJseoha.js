import{_ as U,u as V,h as z,ao as A,r as d,i as B,c as i,d as s,ai as D,t as l,ap as S,F as E,l as N,w as F,v as R,aq as j,f as y,g as q,o as r,p as G}from"./index-Dj3ETPvc.js";const H={class:"post-detail-page"},J={key:0,class:"post-detail-container"},K={class:"post-cover-container"},O=["src","alt"],Q={class:"cover-overlay"},W={class:"post-title"},X={class:"post-info-card"},Y={class:"post-meta"},Z={class:"author-info"},ss=["src","alt"],ts={class:"author-details"},es={class:"author-name"},os={class:"post-time"},as={class:"post-stats"},ns={class:"stat-item"},ls={class:"stat-item"},is={class:"post-content"},rs={class:"action-buttons"},cs={class:"btn-icon"},ds={class:"comments-section"},us={class:"section-header"},vs={class:"comment-count"},ms={class:"comments-list"},ps=["src","alt"],_s={class:"comment-content"},hs={class:"comment-header"},fs={class:"comment-username"},gs={class:"comment-time"},ys={class:"comment-text"},bs={key:0,class:"empty-comments"},ks={key:1,class:"loading-container"},ws={class:"popup-header"},Cs={class:"popup-content"},xs={class:"input-footer"},$s={class:"char-count"},Ds=["disabled"],Ss={key:0},Ps={key:1},Ls={__name:"PostDetailView",setup(Ms){const P=A();q();const b=V(),L=z(),u=P.params.id,a=d(null),v=d([]),c=d(""),m=d(!1),h=d(!1),p=d(!1),n=(e,t="info")=>{const o=document.createElement("div");o.className=`toast toast-${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{document.body.removeChild(o)},300)},3e3)},f=async()=>{try{const e=await y.get(`http://localhost:3000/api/posts/${u}`);e.data.code===200?(Array.isArray(e.data.data)&&e.data.data.length>0?a.value=e.data.data[0]:(a.value=null,n("未找到帖子详情","error"),console.error("未找到帖子详情:",e.data)),console.log("帖子详情:",a.value)):(n("获取帖子详情失败: "+e.data.message,"error"),console.error("获取帖子详情失败:",e.data.message))}catch(e){n("获取帖子详情异常","error"),console.error("获取帖子详情异常:",e)}},k=async()=>{try{const e=await y.get(`http://localhost:3000/api/posts/${u}/comments`);e.data.code===200?(v.value=e.data.data,console.log("评论列表:",v.value)):(n("获取评论列表失败: "+e.data.message,"error"),console.error("获取评论列表失败:",e.data.message))}catch(e){n("获取评论列表异常","error"),console.error("获取评论列表异常:",e)}},M=async()=>{if(!c.value.trim()){n("评论内容不能为空","warning");return}const e=b.userInfo;if(!e||!e.id){n("请先登录","warning");return}p.value=!0;try{const t=await y.post(`http://localhost:3000/api/posts/${u}/comments`,{userId:e.id,content:c.value.trim()});t.data.code===200?(n("评论成功","success"),c.value="",m.value=!1,k(),f()):(n("评论失败: "+t.data.message,"error"),console.error("评论失败:",t.data.message))}catch(t){n("评论异常","error"),console.error("评论异常:",t)}finally{p.value=!1}},T=async()=>{try{const e=await L.likePost(u);e.code===200?(n("点赞成功","success"),h.value=!0,f()):(n("点赞失败: "+e.message,"error"),console.error("点赞失败:",e.message))}catch(e){n("点赞异常","error"),console.error("点赞异常:",e)}},w=e=>{const t=b.cachedUsers.find(o=>o.id===e);return t?t.avatar:"https://img.yzcdn.cn/vant/user-default.png"},C=e=>{const t=new Date(e),_=new Date-t,g=Math.floor(_/6e4),x=Math.floor(_/36e5),$=Math.floor(_/864e5);return g<1?"刚刚":g<60?`${g}分钟前`:x<24?`${x}小时前`:$<7?`${$}天前`:t.toLocaleDateString()};B(()=>{u?(f(),k()):n("帖子ID缺失","error")});const I=()=>history.back();return(e,t)=>(r(),i("div",H,[t[19]||(t[19]=s("div",{class:"gradient-strip"},null,-1)),s("div",{class:"nav-bar"},[s("button",{class:"back-btn",onClick:I},t[6]||(t[6]=[s("i",{class:"icon"},"←",-1),s("span",null,"返回",-1)])),t[7]||(t[7]=s("h1",{class:"nav-title"},"📖 帖子详情",-1)),t[8]||(t[8]=s("div",{class:"nav-placeholder"},null,-1))]),a.value?(r(),i("div",J,[s("div",K,[s("img",{class:"post-cover",src:a.value.cover_image||"placeholder.jpg",alt:a.value.title,onError:t[0]||(t[0]=o=>o.target.src="https://via.placeholder.com/400x250/f0f0f0/999?text=暂无图片")},null,40,O),s("div",Q,[s("h2",W,l(a.value.title),1)])]),s("div",X,[s("div",Y,[s("div",Z,[s("img",{class:"author-avatar",src:w(a.value.user_id),alt:a.value.username},null,8,ss),s("div",ts,[s("span",es,l(a.value.username||"未知用户"),1),s("span",os,l(C(a.value.created_at)),1)])]),s("div",as,[s("div",ns,[t[9]||(t[9]=s("i",{class:"stat-icon"},"👍",-1)),s("span",null,l(a.value.like_count),1)]),s("div",ls,[t[10]||(t[10]=s("i",{class:"stat-icon"},"💬",-1)),s("span",null,l(a.value.comment_count),1)])])]),s("div",is,[s("p",null,l(a.value.content),1)])]),s("div",rs,[s("button",{class:S(["action-btn like-btn",{liked:h.value}]),onClick:T},[s("i",cs,l(h.value?"❤️":"🤍"),1),s("span",null,"点赞 ("+l(a.value.like_count)+")",1),t[11]||(t[11]=s("div",{class:"ripple"},null,-1))],2),s("button",{class:"action-btn comment-btn",onClick:t[1]||(t[1]=o=>m.value=!0)},[t[12]||(t[12]=s("i",{class:"btn-icon"},"💬",-1)),s("span",null,"评论 ("+l(a.value.comment_count)+")",1),t[13]||(t[13]=s("div",{class:"ripple"},null,-1))])]),s("div",ds,[s("div",us,[t[14]||(t[14]=s("h3",null,"💭 评论列表",-1)),s("span",vs,l(v.value.length)+"条评论",1)]),s("div",ms,[(r(!0),i(E,null,N(v.value,(o,_)=>(r(),i("div",{key:o.id,class:"comment-item",style:G({animationDelay:`${_*.1}s`})},[s("img",{class:"comment-avatar",src:w(o.user_id),alt:o.username},null,8,ps),s("div",_s,[s("div",hs,[s("span",fs,l(o.username||"未知用户"),1),s("span",gs,l(C(o.created_at)),1)]),s("p",ys,l(o.content),1)])],4))),128)),v.value.length===0?(r(),i("div",bs,t[15]||(t[15]=[s("i",{class:"empty-icon"},"💭",-1),s("p",null,"还没有评论，快来抢沙发吧！",-1)]))):D("",!0)])])])):(r(),i("div",ks,t[16]||(t[16]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"加载中...",-1)]))),m.value?(r(),i("div",{key:2,class:"comment-popup-overlay",onClick:t[5]||(t[5]=o=>m.value=!1)},[s("div",{class:"comment-popup",onClick:t[4]||(t[4]=j(()=>{},["stop"]))},[s("div",ws,[t[17]||(t[17]=s("h3",null,"✍️ 写评论",-1)),s("button",{class:"close-btn",onClick:t[2]||(t[2]=o=>m.value=!1)},"✕")]),s("div",Cs,[F(s("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>c.value=o),class:"comment-input",placeholder:"分享你的想法...",maxlength:"200",rows:"4"},null,512),[[R,c.value]]),s("div",xs,[s("span",$s,l(c.value.length)+"/200",1)]),s("button",{class:S(["submit-btn",{loading:p.value}]),disabled:p.value||!c.value.trim(),onClick:M},[p.value?(r(),i("span",Ps,"发布中...")):(r(),i("span",Ss,"发布评论")),t[18]||(t[18]=s("div",{class:"ripple"},null,-1))],10,Ds)])])])):D("",!0),t[20]||(t[20]=s("div",{class:"bottom-decoration"},[s("div",{class:"decoration-text"},"✨ 分享精彩瞬间 ✨")],-1))]))}},Is=U(Ls,[["__scopeId","data-v-567a53eb"]]);export{Is as default};
